function includeAgentInfo(t){t=t||{};var e=packageJson.version,n=e.lastIndexOf(".");t.agentVersion=e.substring(0,n),t.agentInstallPath=__dirname}function AgentAPI(t){return agentInstace||(includeAgentInfo(t),agent.init(t),agentInstace=global.apmInsightAgentInstance),AgentAPI}var cachedModules=[];cachedModules[4747]={exports:{}},function(t,e){function n(t){return void 0===t||null===t||""===t}function r(t){return"string"==typeof t&&!n(t)&&/\S/.test(t)}function o(t){return void 0===t||null==t?!1:"number"!=typeof t?!1:!(0>t)}function i(t){return!(-1==="0123456789".indexOf(t))}function a(t){return!("number"!=typeof t)}function s(t){return 1===t.length&&null!=t.match(/[a-z]/i)}function c(t){return"function"==typeof t}function p(t){return"object"==typeof t}function u(t){if(n(t))return{};try{var e=g.join(t,"apminsight.json");return l.existsSync(e)?JSON.parse(l.readFileSync(e)):{}}catch(r){}return{}}function h(t){var e;if(r(t.logsDir)&&r(t.appName)){var n="apminsightdata_"+t.appName+"_"+t.port;e=g.join(t.logsDir,n)}else e=g.join(process.cwd(),"apminsightdata");try{l.existsSync(e)||l.mkdirSync(e)}catch(o){return void console.log("Not able to create apminsight agent logs in "+e)}return e}function d(t){var e={uri:"",queryParam:""};if(t&&r(t.url)){var n=f.parse(t.url).pathname,o=n.indexOf("?");o>0?(e.uri=n.substr(0,o),n.length>o+1&&(e.queryParam=n.substr(o+1))):e.uri=n}return e}var l=require("fs"),g=require("path"),f=require("url");t.exports={isEmpty:n,isNumber:i,isTypeNumber:a,isPositiveNumber:o,isNonEmptyString:r,isLetter:s,isFunction:c,parseReq:d,isObject:p,loadInfoFileSync:u,checkAndCreateBaseDir:h}}.call(this,cachedModules[4747],cachedModules[4747].exports),cachedModules[8837]={exports:{}},function(t,e){var n=require("process");const r="license.key",o="application.name",i="application.port",a="plusinsight.site24x7.com",s="plusinsight.site24x7.eu",c="plusinsight.site24x7.cn",p="plusinsight.site24x7.in",u="plusinsight.site24x7.net.au",h="443",d="POST",l="/arh/connect",g="/arh/data",f="/arh/serverless/data",m="/arh/trace",y="/arh/serverless/trace",I="apdex.threshold",x="sql.capture.enabled",T="transaction.trace.sql.parametrize",v="last.modified.time",_="transaction.trace.threshold",C="transaction.trace.enabled",A="transaction.trace.sql.stacktrace.threshold",M="transaction.tracking.request.interval",k="autoupgrade.enabled",b="transaction.skip.listening",E="webtransaction.tracker.drop.threshold",S="webtransaction.trace.external.components.count.threshold",N=/\/\d+(?=\/)/g,R="bgtransaction.tracking.enabled",w="bgtransaction.trace.enabled",D="bgtransaction.trace.threshold",P="bgtransaction.tracking.request.interval",O="distributed.tracing.enabled",q="X-Site24x7-Id",F=q.toLowerCase(),L="X-Site24x7-Dt-Data",K=L.toLowerCase(),B="content-length",j="apminsight.log.level",U="metricstore.metric.bucket.size",H="metricstore.dbmetric.bucket",W="metricstore.bgmetric.bucket.size",Q="transaction.tracestore.size",z="INFO",G="WARNING",J="DEBUG",Y="CRITICAL",V="ERROR",X="AWS",$="AZURE",Z="169.254.169.254";agentInfo="agent_info",applicationType="NODEJS",agentInstallPath="AgentInstallPath",instanceInfo="instance-info",instanceId="instanceid",instance_Id="instance_id",responseCode="response-code",host="host",port="port",customConfigInfo="custom_config_info",agentSpecifInfo="agent_specific_info",licenseExpired=701,licenseInstanceExceeded=702,instanceAddFailed=703,deleteAgent=900,invalidAgent=901,unmanageAgent=910,manageAgent=911,agentLicenseUpdated=915,agentConfigUpdated=920,shutdown=0,webTxnPrefix="transaction/http/",bgTxnPrefix="transaction/bckgrnd/",apdex="apdex",bckgrnd="bckgrnd",appParam="appparam",sumStr="sum",avgStr="average",emptyString="",homeDir=n.env.HOME||n.env.USERPROFILE,externalComponents=["MYSQL","PGSQL","MEMCACHED","MONGODB","REDIS","CASSANDRA","WEBREQUEST","MSSQL","ORACLEDB"],dbOpnOverAll="db/all/all/dummy-db",maxTrackers=1e3,maxExcPerTrace=20,dbTracker=1,selectQueryMatcher=/\s*(select)\s+.*from\s+(\S+)?.*/i,insertQueryMatcher=/\s*(insert)\s+into\s+(\S+)?[(]?.*/i,updateQueryMatcher=/\s*(update)\s+(\S+)?.*/i,deleteQueryMatcher=/\s*(delete)\s+.*from\s+(\S+)?.*/i,createQueryMatcher=/\s*(create)\s+(?:table|procedure|database)\s+(\S+)?[(]?.*/i,dropQueryMatcher=/\s*(drop)\s+(?:table|procedure|database)\s+(\S+)?.*/i,alterQueryMatcher=/\s*(alter)\s+(?:table|procedure|database)\s+(\S+)?.*/i,callSPMatcher=/\s*(call)\s+([`\w]+)[\s()]*.*/i,execSPMatcher=/\s*(exec)\s+([`\w]+)[\s()]*.*/i,showQueryMatcher=/\s*(show)\s+(\w+)(\s+)?.*/i,firstSyllable=/\s*(\w+)\s+.*/i,stackTraceRegex=/^\s*at .*(\S+\:\d+)/m,dbOpnRegex={select:selectQueryMatcher,insert:insertQueryMatcher,update:updateQueryMatcher,"delete":deleteQueryMatcher,create:createQueryMatcher,drop:dropQueryMatcher,alter:alterQueryMatcher,show:showQueryMatcher,call:callSPMatcher,exec:execSPMatcher},t.exports={licenseKey:r,appNameKey:o,appPortKey:i,connectUrl:l,dataUrl:g,dataServerlessUrl:f,traceUrl:m,traceServerlessUrl:y,usCollectorHostName:a,euCollectorHostName:s,cnCollectorHostName:c,indCollectorHostName:p,ausCollectorHostName:u,collectorPort:h,requestMethod:d,apdexThKey:I,sqlCaptureKey:x,sqlParametrizeKey:T,lastModifiedTimeKey:v,traceThresholdKey:_,traceEnabledKey:C,sqlStracktraceKey:A,webTxnsamplingFactorKey:M,autoUpgradeKey:k,txnSkipListeningKey:b,txnTrackerDropThKey:E,txnTraceExtCountThKey:S,txnNormalizationRegex:N,bgTxnTrackingEnabledKey:R,bgTxnSamplingFactorKey:P,bgTxnTraceEnabledKey:w,bgTxnTraceThKey:D,distributedTracingKey:O,crossAppReqHeader:q,crossAppReqHeaderLower:F,crossAppResHeader:L,crossAppResHeaderLower:K,contentLengthHeader:B,apdexMetricKey:U,dbMetricKey:H,bgMetricKey:W,traceMetricKey:Q,info:z,warning:G,critical:Y,error:V,debug:J,aws:X,azure:$,cloudCheckerHost:Z,agentInfo:agentInfo,applicationType:applicationType,agentInstallPath:agentInstallPath,host:host,port:port,instanceInfo:instanceInfo,instanceid:instanceId,instance_Id:instance_Id,responseCode:responseCode,customConfigInfo:customConfigInfo,agentSpecifInfo:agentSpecifInfo,logLevel:j,licenseExpired:licenseExpired,instanceAddFailed:instanceAddFailed,licenseInstanceExceeded:licenseInstanceExceeded,deleteAgent:deleteAgent,invalidAgent:invalidAgent,unmanageAgent:unmanageAgent,manageAgent:manageAgent,agentConfigUpdated:agentConfigUpdated,agentLicenseUpdated:agentLicenseUpdated,shutdown:shutdown,webTxnPrefix:webTxnPrefix,bgTxnPrefix:bgTxnPrefix,apdex:apdex,bckgrnd:bckgrnd,appParam:appParam,sumStr:sumStr,avgStr:avgStr,emptyString:emptyString,homeDir:homeDir,maxTrackers:maxTrackers,maxExcPerTrace:maxExcPerTrace,dbTracker:dbTracker,externalComponents:externalComponents,dbOpnOverAll:dbOpnOverAll,dbOpnRegex:dbOpnRegex,firstSyllable:firstSyllable,stackTraceRegex:stackTraceRegex}}.call(this,cachedModules[8837],cachedModules[8837].exports),cachedModules[6725]={exports:{}},function(t,e){function n(t){if(!v){if(t.isAppIdConfigured()||E.isEmpty(t.getBaseDir()))return void(v=console.log);M=t.getBaseDir();var e=new Date,n=e.getMonth()+1,r=e.getDate()+P+n+P+e.getFullYear()+P+e.getHours()+P+e.getMinutes()+P+e.getSeconds()+P+e.getMilliseconds()+P+process.pid;try{C=b.join(M,"logs"),k.existsSync(C)||k.mkdirSync(C),o();var i=b.join(C,"apminsight_agent_logs_"+r+".log"),a=k.openSync(i,"a");_&&_.end(),_=k.createWriteStream(null,{flags:"a",fd:a}),_.on("error",g),A=0}catch(s){console.log("Not able to create apminsight agent logs in "+i)}}}function r(t){E.isFunction(t)&&(v=t)}function o(){N.isMaster&&!C&&k.readdir(C,function(t,e){if(!t){var n=new Date;n.setDate(n.getDate()-q);var r=n.getTime();e.forEach(function(t,e){i(b.join(C,t),r)})}})}function i(t,e){k.stat(t,function(n,r){n||r.mtime.getTime()<e&&a(t)})}function a(t){k.unlink(t,function(t){}),l(S.info,"old log files removed properly")}function s(t,e){f(S.error,t,x,e)}function c(t,e,n){throw l(t,e,n),new Error(e)}function p(t,e){l(S.debug,t,e)}function u(t,e){l(S.info,t,e)}function h(t,e){l(S.critical,t,e)}function u(t,e){l(S.info,t,e)}function d(t,e){l(S.warning,t,e)}function l(t,e,n){f(t,e,T,n)}function g(t){}function f(t,e,r,o){if(m(F[t])){var i=I()+w+"["+t+"]"+w+e+w+r(o);_?(A>O&&n(M),A+=Buffer.byteLength(i),_.write(i+R)):v&&v(i)}}function m(t){return!!(t<=y())}function y(){return global.apmInsightAgentInstance&&F[apmInsightAgentInstance.getThreshold().getLogLevel()]?F[apmInsightAgentInstance.getThreshold().getLogLevel()]:F.DEBUG}function I(){var t=new Date,e=t.getMonth()+1;return"["+t.getDate()+"/"+e+"/"+t.getFullYear()+w+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+"]"}function x(t){try{return E.isEmpty(t)?D:t.stack}catch(t){return D}}function T(t){try{return E.isEmpty(t)?D:JSON.stringify(t)}catch(e){return D}}var v,_,C,A,M,k=require("fs"),b=require("path"),E=cachedModules[4747].exports,S=cachedModules[8837].exports,N=require("cluster"),R="\n",w=" ",D="",P="_",O=10485760,q=10,F={DEBUG:5,INFO:4,WARNING:3,CRITICAL:2,ERROR:1,OFF:0};t.exports={init:n,debug:p,info:u,warning:d,critical:h,error:s,logAndThrowError:c,checkAndUpdateLogFunc:r}}.call(this,cachedModules[6725],cachedModules[6725].exports),cachedModules[8685]={exports:{}},function(t,e){function n(t){this._time=(new Date).getTime(),this._error=t,this._stackFrames=null}function r(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/,n=e.exec(t.replace(/[\(\)]/g,""));return[n[1],n[2]||"",n[3]||""]}var o=cachedModules[8837].exports,i=cachedModules[4747].exports;n.prototype.getTime=function(){return this._time},n.prototype.getType=function(){if(this._errorType)return this._errorType;var t="Error",e=this._error.code;return i.isEmpty(this._error.name)||this._error.name===t?i.isEmpty(e)?this._errorType=t:this._errorType="string"==typeof e?e:e.toString():this._errorType=this._error.name,this._errorType},n.prototype.getLevel=function(){return"FATAL"},n.prototype.getMessage=function(){return this._error.message},n.prototype.getErrorStackFrames=function(){if(this._stackFrames)return this._stackFrames;var t=this._error.stack.split("\n").filter(function(t){return t.match(o.stackTraceRegex)});return this._stackFrames=t.map(function(t){var e=t.replace(/^\s+/,"").split(/\s+/).slice(1),n=r(e.pop()),o=e.join(" ")||"",i=n[0]?n[0]:"";return["",o,i,n[1]]}),this._stackFrames},t.exports=n}.call(this,cachedModules[8685],cachedModules[8685].exports),cachedModules[9164]={exports:{}},function(t,e){function n(t){this._parent=t.parent,this._startTime=(new Date).getTime(),this._name=t.trackerName,this._component=t.component?t.component:"",this._sync=!!t.sync,this._byApi=!!t.api,this._stale=t.stale?t.stale:!1,this._compAppended=!1,this._endTime=0,this._time=0,this._childOverhead=0,this._info={},this._child=[],this._error=null,this._completed=!1}function r(t){n.call(this,t),this._minRt=0,this._maxRt=0,this._count=0,this._errorCount=0,this.isDbTracker=!0}function o(t){if(!t)return"";for(var e="",n=t.length,r=0;n>r;r++){var o=t.charAt(r);if("'"===o||'"'===o){var i=o;for(e+="?",r++;n>r;r++)if(o=t.charAt(r),"\\"==o&&n-1>r)r++;else if(o==i)break;if(r>=n)break}else if(a.isNumber(o)||"."===o&&n-1>r&&a.isNumber(t.charAt(r+1))){for(e+="?";n>r&&(o=t.charAt(r),a.isNumber(o)||"."===o);)r++;if(r>=n)break;r--}else{if(!a.isLetter(o)&&"_"!==o){e+=o;continue}for(;n>r&&(o=t.charAt(r),a.isLetter(o)||"_"==o||a.isNumber(o));)e+=o,r++;if(r>=n)break;r--}}return e}function i(t){var e={trackerName:t,sync:!0};return new n(e)}var a=cachedModules[4747].exports,s=(cachedModules[6725].exports,cachedModules[8837].exports),c=require("util"),p=cachedModules[8685].exports;n.prototype.getInfo=function(){return this._info},n.prototype.updateInfo=function(t){this._info=Object.assign(this._info,t)},n.prototype.getStartTime=function(){return this._startTime},n.prototype.getTrackerName=function(){return this._name},n.prototype.getTrackerNameForTrace=function(){var t=this._name.indexOf(".prototype.")?this._name.replace(".prototype",""):this._name;if(this.isError())return apmInsightAgentInstance.getConfig().isCatalyst()?t:t+" : "+this.getErrorInfo().getType();var e=this.getInfo();return e.opn&&(t=this._component+" - "+e.opn),e.method&&e.statusCode&&e.url?e.method+" - "+e.statusCode+" - "+e.url:e.host&&e.port?t+" - "+e.host+":"+e.port:t},n.prototype.getComponent=function(){return this._component},n.prototype.getTime=function(){return this._time},n.prototype.getChildOverhead=function(){return this._childOverhead},n.prototype.checkAndUpdateExclusiveTime=function(t){if(this._sync&&t&&t.isSync()){var e=t.getTime()+t.getChildOverhead();this._childOverhead+=e}},n.prototype.getChildTrackers=function(){return this._child},n.prototype.isAllowedInTrace=function(){return this._stale||!this.isCompleted()?!1:this.isError()||this.isCustomTracker()?!0:!a.isEmpty(this.getComponent())&&s.externalComponents.indexOf(this.getComponent())>=0?!0:this._time>=apmInsightAgentInstance.getThreshold().getTxnTrackerDropThreshold()},n.prototype.getAdditionalInfo=function(){var t={};return this.isError()&&(t.exception_st=this.getErrorInfo().getErrorStackFrames()),this._info.dtdata&&(t.dtdata=this._info.dtdata),t},n.prototype.updateEndTime=function(){this._endTime=(new Date).getTime(),this._time=this._endTime-this._startTime-this._childOverhead},n.prototype.setError=function(t,e){t&&!t.apmAgentHandled&&(this._error=new p(t),t.apmAgentHandled=!0,e.checkAndAddError(this._error.getType()))},n.prototype.setActive=function(){this._stale&&!this._compAppended&&(apmInsightAgentInstance.checkAndAddComponent(apmInsightAgentInstance.getCurTxn(),this),this._compAppended=!0),this._stale=!1},n.prototype.isError=function(){return!!this._error},n.prototype.getErrorInfo=function(){return this._error},n.prototype.endTracker=function(t,e){return this.isCompleted()?!1:!t||t.isCompleted()?!1:(this._completed=!0,this.setError(e,t),this.updateEndTime(),this._stale||this._compAppended||(apmInsightAgentInstance.checkAndAddComponent(t,this),this._compAppended=!0),this._parent&&this._parent.checkAndUpdateExclusiveTime(this),!0)},n.prototype.addChildTracker=function(t){this._child.push(t)},n.prototype.isCompleted=function(){return this._completed},n.prototype.isSync=function(){return this._sync},n.prototype.isCustomTracker=function(){return this._byApi},n.prototype.isDistributedTrace=function(){return this._dtrace},n.prototype.setDistributedTrace=function(){this._dtrace=!0},n.prototype.updateDtInfo=function(t){this.updateInfo({dtdata:t}),this.setDistributedTrace()},c.inherits(r,n),r.prototype.endTracker=function(t){var e=n.prototype.endTracker.apply(this,arguments);e&&t.addDbCall(this)},r.prototype.isAllowedInTrace=function(){return!!this.isCompleted()},r.prototype.getCount=function(){return this._count},r.prototype.getErrorCount=function(){return this._errorCount},r.prototype.getMinRt=function(){return this._minRt},r.prototype.getMaxRt=function(){return this._maxRt},r.prototype.getTrackerNameForTrace=function(){if(!this._info.opn)return this._name.indexOf(".prototype.")?this._name.replace(".prototype",""):this._name;var t=this._component+" - "+this._info.opn;return this._info.host&&this._info.port&&(t+=" - "+this._info.host+":"+this._info.port),this.isError()&&(t+=" : "+this.getErrorInfo().getType()),t},r.prototype.getAdditionalInfo=function(){var t={};return this.isError()&&(t.stacktrace=this.getErrorInfo().getErrorStackFrames()),"MONGODB"===this.getComponent()&&this._info.opn&&this._info.object?t.query=this._info.opn+" - "+this._info.object:apmInsightAgentInstance.getThreshold().isSqlParameterized()?t.query=o(this._info.query):t.query=this._info.query,t},r.prototype.extractOperationInfo=function(){if(this._info.opn&&this._info.object)return this._info;if(this._info.query){var t=s.firstSyllable.exec(this._info.query),e=s.dbOpnRegex[t[1].toLowerCase()];if(e){var n=e.exec(this._info.query);if(n)return this._info.opn=n[1].toUpperCase(),this._info.object=n[2],this._info}}else if("MONGODB"===this.getComponent()){var r=this.getTrackerName().split(".");return this._info.opn=r.pop().toUpperCase(),this._info}return{}},r.prototype.aggregate=function(t){var e=t.extractOperationInfo();return this._info.opn=e.opn,this._info.object=e.object,this._component=t.getComponent(),t.isError()?void(this._errorCount+=1):(this._time+=t.getTime(),this._count+=1,(0===this._minRt||t.getTime()<this._minRt)&&(this._minRt=t.getTime()),void((0===this._maxRt||this._maxRt<t.getTime())&&(this._maxRt=t.getTime())))},t.exports={Tracker:n,DbTracker:r,createRootTracker:i}}.call(this,cachedModules[9164],cachedModules[9164].exports),cachedModules[3996]={exports:{}},function(t,e){function n(t,e){if(!g.isNonEmptyString(t))return void f.info("app metric invoked with improper value "+t);e=g.isNumber(e)?e:1;var n=v[t];v[t]=n?n+e:e}function r(t,e){if(!g.isNonEmptyString(t)||!g.isNumber(e))return void f.info("app metric invoked with improper value :: metricname:"+t+", value:"+e);var n=_[t];n?(n.total+=e,n.min=e<n.min?e:n.min,n.max=e>n.max?e:n.min,n.count++):_[t]={total:e,min:e,max:e,count:1}}function o(){return m}function i(){return y}function a(){return I}function s(){return T}function c(){return v}function p(){return _}function u(){return x}function h(t){return T+=t}function d(){m={},y={},I=[],T=0,_={},v={}}function l(){x={}}var g=cachedModules[4747].exports,f=cachedModules[6725].exports,m={},y={},I=[],x={},T=0,v={},_={};t.exports={getWebTxnMetric:o,getBgTxnmetric:i,getTraceMetric:a,getDbCallCount:s,updateAndGetDbCount:h,getTraceHistory:u,incrAppMetric:n,avgAppMetric:r,getAppMetricSum:c,getAppMetricAvg:p,clearMetric:d,clearTraceHistory:l}}.call(this,cachedModules[3996],cachedModules[3996].exports),cachedModules[7985]={exports:{}},function(t,e){function n(t,e,n,o,i){if(apmInsightAgentInstance.getConfig().isAppIdConfigured()||process.env.APMINSIGHT_INSTANCE_ID)try{t[e.getUrl()]=e,s.getTraceMetric().push(e),apmInsightAgentInstance.sendMetricsImmediately()}catch(c){a.error("unable to send collected data",c)}finally{s.clearMetric()}else r(t,e,n,o,i)}function r(t,e,n,r,i){var c=!1;if(t[e.getUrl()]?(c=!0,matchedTxn=t[e.getUrl()]):matchedTxn=new n({}),matchedTxn.incrementAndGetOcurrence()%r!==0)return void a.critical("txn dropped due to sampling factor");if(c||Object.keys(t).length<=i){var p=s.updateAndGetDbCount(e.getDbCalls().length);p>apmInsightAgentInstance.getThreshold().getDbMetricSize()&&e.clearDbCalls(),matchedTxn.aggregate(e),t[e.getUrl()]=matchedTxn}o(e)}function o(t){var e=apmInsightAgentInstance.getThreshold(),n=s.getTraceMetric();if(!(n.length>e.getTraceMetricSize())){var r=0,o=Object.keys(t.getErrorsInfo()).length;t.getRt()>=e.getTraceThreshold()&&(r|=8),o>0&&(r|=16),t.getExtCallCount>e.getTxnTraceExtCallThreshold()&&(r|=32),(apmInsightAgentInstance.getConfig().isCatalyst()||r>0&&i(t,o))&&n.push(t)}}function i(t,e){var n=t.getUrl()+"-"+t.getMethod(),r=s.getTraceHistory();if(r[n]){var o=r[n];return o.errcount<e?(o.errcount=e,!0):o.rt<t.getRt()?(o.rt=t.getRt(),!0):o.extcount<t.getExtCallCount()?(o.extcount=t.getExtCallCount(),!0):!1}var i={rt:t.getRt(),errcount:e,extcount:t.getExtCallCount()};return r[n]=i,!0}var a=(cachedModules[4747].exports,cachedModules[6725].exports),s=cachedModules[3996].exports;t.exports={checkAndIncludeInStore:n}}.call(this,cachedModules[7985],cachedModules[7985].exports),cachedModules[5843]={exports:{}},function(t,e){function n(t){this._startTime=(new Date).getTime(),this._responseTime=0,this._minRt=0,this._maxRt=0,this._errorRt=0,this._count=0,this._endTime=0,this._errorCount=0,this._completed=!1,this._dbCalls=[],this._intCompInfo={},this._extCompInfo={},this._extCallCount=0,this._errInfo={},this._ocurrence=-1,this._traceReason=0,this._byApi=!!t.api,this._ignore=!1,this._rootTracker=a.createRootTracker(t.rootListner),this._trackersCount=0,this._sqlTrackersCount=0,this._customParams={}}function r(t,e,n){var r=t[n];r?t[n].aggregate(e):t[n]=e}function o(t,e){var n=Object.keys(e);return 0==n.length?t:void n.forEach(function(n){var r=t[n];if(r){var o=e[n];return void(t[n]=r.aggregateAsNewComponent(o))}t[n]=e[n]})}function i(t){var e=Object.keys(t),n={success:{},fail:{}};return e.length<=0?n:(e.forEach(function(e){var r=t[e];n.success[r.getName()]?(n.success[r.getName()]+=t[e].getCount(),n.fail[r.getName()]+=t[e].getErrorCount()):(n.success[r.getName()]=t[e].getCount(),n.fail[r.getName()]=t[e].getErrorCount())}),n)}var a=cachedModules[9164].exports,s=cachedModules[4747].exports,c=cachedModules[6725].exports,p=cachedModules[7985].exports;n.prototype.updateRtMetric=function(){this._endTime=(new Date).getTime(),this._responseTime=this._endTime-this._startTime,this._minRt=this._responseTime,this._maxRt=this._responseTime},n.prototype.updateReqCountByErr=function(t){t instanceof Error?(this._errorCount=1,this.getRootTracker().setError(t,this)):this._count=1},n.prototype.aggregateNonErrorTxn=function(t){this._url=t.getUrl(),this._responseTime+=t.getRt(),this._count+=t.getCount(),this.aggregateTxnSubResources(t),(0===this._minRt||t.getMinRt()<this._minRt)&&(this._minRt=t.getMinRt()),(0===this._maxRt||this._maxRt<t.getMaxRt())&&(this._maxRt=t.getMaxRt())},n.prototype.aggregateTxnSubResources=function(t){this._dbCalls=this._dbCalls.concat(t.getDbCalls()),o(this._intCompInfo,t.getInternalCompInfo()),o(this._extCompInfo,t.getExtCompInfo()),this.aggregateErrors(t.getErrorsInfo())},n.prototype.aggregateComponent=function(t){if(t)if(t.isExt()>0){var e=t.getName()+t.getHost()+t.getPort();r(this._extCompInfo,t,e),this._extCallCount+=t.getCount()+t.getErrorCount()}else r(this._intCompInfo,t,t.getName())},n.prototype.checkAndAddError=function(t){s.isEmpty(t)||(this._errInfo[t]?this._errInfo[t]+=this._errInfo[t]:this._errInfo[t]=1)},n.prototype.aggregateErrors=function(t){var e=Object.keys(t),n=this;e.forEach(function(e){return n._errInfo[e]?void(n._errInfo[e]+=t[e]):void(n._errInfo[e]=1)})},n.prototype.getComponentDetails=function(){var t=[],e=this._intCompInfo,n=this._extCompInfo;return Object.keys(e).forEach(function(n){t.push(e[n].getInfoAsObj())}),Object.keys(n).forEach(function(e){t.push(n[e].getInfoAsObj())}),t},n.prototype.getErrorDetails=function(){var t={},e=0,n=this._errInfo;return Object.keys(n).forEach(function(r){var o=n[r];t[r]=o,e+=o}),t.warning=0,t.fatal=e,t},n.prototype.appendCompInfoInTrace=function(t){t.ext_components=i(this._extCompInfo),t.int_components=i(this._intCompInfo)},n.prototype.checkAndupdateInDataStore=function(t,e,n,r){p.checkAndIncludeInStore(t,this,e,n,r)},n.prototype.isTxnIgnored=function(){return this.isCompleted()?(c.critical("End txn called again",this.getUrl()),!0):this._ignore},n.prototype.setTransactionName=function(t){this._url=t},n.prototype.setCustomParams=function(t,e){var n=this._customParams;if(n){var r=n[t];s.isEmpty(r)?Object.keys(n).length<10&&(r=[],r.push(e),n[t]=r):r.length<10&&r.push(e)}},n.prototype.endRootTracker=function(t){this._rootTracker.endTracker(this,t)},n.prototype.getRootTracker=function(){return this._rootTracker},n.prototype.getDbCalls=function(){return this._dbCalls},n.prototype.getInternalCompInfo=function(){return this._intCompInfo},n.prototype.getExtCompInfo=function(){return this._extCompInfo},n.prototype.getErrorsInfo=function(){return this._errInfo},n.prototype.addDbCall=function(t){this._dbCalls.push(t),this.incrSqlTrackersCount()},n.prototype.clearDbCalls=function(){this._dbCalls=[]},n.prototype.isCompleted=function(){return this._completed},n.prototype.isErrorTxn=function(){return this._errorCount>0},n.prototype.markCompeletd=function(){this._completed=!0},n.prototype.getUrl=function(){return this._url},n.prototype.getStartTime=function(){return this._startTime},n.prototype.getRt=function(){return this._responseTime},n.prototype.getErrorRt=function(){return this._errorRt},n.prototype.getMinRt=function(){return this._minRt},n.prototype.getMaxRt=function(){return this._maxRt},n.prototype.getCount=function(){return this._count},n.prototype.getErrorCount=function(){return this._errorCount},n.prototype.getExtCallCount=function(){return this._extCallCount},n.prototype.getCustomParams=function(){return this._customParams},n.prototype.getCustomParamsAsStr=function(){var t=this.getCustomParams();return Object.keys(t).forEach(function(e){for(var n=t[e],r=0;r<n.length;r++){var o=n[r];try{s.isObject(o)?n[r]=JSON.stringify(o):n[r]=String(o)}catch(i){c.error("error while converting the value "+o+" to string")}}}),t},n.prototype.incrementAndGetOcurrence=function(){return this.incrementOcurrence(),this._ocurrence},n.prototype.incrementOcurrence=function(){this._ocurrence+=1},n.prototype.isCreatedByApi=function(){return this._byApi},n.prototype.setIgnore=function(){this._ignore=!0,c.info(this.getUrl()+" txn ignored by api")},n.prototype.getTrackerCountInfo=function(){return{method_trackers_count:this.getMethdCallsCount(),sql_trackers_count:this.getSqlTrackersCount(),ext_trackers_count:this.getExtTrackersCountExcludingSql()}},n.prototype.getMethdCallsCount=function(){var t=this._trackersCount-this._extCallCount;return 0>t?0:t},n.prototype.getExtTrackersCountExcludingSql=function(){var t=this._extCallCount-this._sqlTrackersCount;return 0>t?0:t},n.prototype.getSqlTrackersCount=function(){return this._sqlTrackersCount},n.prototype.incrSqlTrackersCount=function(){this._sqlTrackersCount++},n.prototype.incrTrackersCount=function(){this._trackersCount++},t.exports=n}.call(this,cachedModules[5843],cachedModules[5843].exports),cachedModules[2486]={exports:{}},function(t,e){function n(t,e){a.call(this,t),this._url=r(t.uri),this._method=e?e.method:"",this._queryParam=t.queryParam,this._apdex=0,this._satisfied=0,this._errorCodeDetails={},this._tolerated=0,this._frustrated=0,this._resCode=0,this._bytesInInfo=o(e),this._bytesOutInfo={}}function r(t){return t?t.replace(u.txnNormalizationRegex,"/*"):""}function o(t){var e={};if(!t)return e;if(t&&t.headers){var n=parseInt(t.headers[u.contentLengthHeader]);return c.isPositiveNumber(n)?{bytes:n}:e}return e}function i(t,e){e.bytes&&(t.bytes?(t.bytes+=e.bytes,t.min=t.min<e.bytes?t.min:e.bytes,t.max=t.max>e.bytes?t.max:e.bytes,t.count++):(t.bytes=e.bytes,t.min=e.bytes,t.max=e.bytes,t.count=1))}var a=cachedModules[5843].exports,s=require("util"),c=cachedModules[4747].exports,p=cachedModules[3996].exports,u=cachedModules[8837].exports;s.inherits(n,a),n.prototype.endTransaction=function(t){if(!this.isTxnIgnored()){var e=t?t.statusCode:0;this.updateRtMetric(),this.updateApdexMetric(),this.updateReqCount(e),this.markCompeletd(),this.updateInDataStore()}},n.prototype.endApiTxn=function(t){this.isCreatedByApi()&&!this.isTxnIgnored()&&(this.updateRtMetric(),this.updateApdexMetric(),this.updateReqCountByErr(t),this.markCompeletd(),this.updateInDataStore())},n.prototype.updateApdexMetric=function(){var t=apmInsightAgentInstance.getThreshold();this._responseTime<=1e3*t.getApdexTh()?this._satisfied=1:this._responseTime<=4*t.getApdexTh()*1e3?this._tolerating=1:this._frustrated=1},n.prototype.updateReqCount=function(t){this._resCode=t,c.isPositiveNumber(t)&&t>=400?(this._errorCount=1,this._errorCodeDetails[t]=1):this._count=1},n.prototype.aggregate=function(t){return this._url=t.getUrl(),this.checkAndAggregateBytes(t),t.isErrorTxn()?(this._errorCount+=t.getErrorCount(),this._errorRt+=t.getRt(),void this.aggregateTxnSubResources(t)):(this.aggregateNonErrorTxn(t),this._satisfied+=t.getSatisfied(),this._tolerated+=t.getTolerated(),void(this._frustrated+=t.getFrustrated()))},n.prototype.checkAndAggregateBytes=function(t){i(this._bytesInInfo,t.getBytesInInfo()),i(this._bytesOutInfo,t.getBytesOutInfo())},n.prototype.aggregateErrorCode=function(t){var e=Object.keys(t),n=this;e.forEach(function(t){return n._errorCodeDetails[t]?void(n._errorCodeDetails[t]+=1):void(n._errorCodeDetails[t]=1)})},n.prototype.updateInDataStore=function(){var t=p.getWebTxnMetric(),e=apmInsightAgentInstance.getThreshold().getWebTxnSamplingFactor(),r=apmInsightAgentInstance.getThreshold().getApdexMetricSize();this.checkAndupdateInDataStore(t,n,e,r)},n.prototype.getFormattedRtData=function(){var t=0;this.getCount()>0&&(t=(this.getSatisfied()+this.getTolerated()/2)/this.getCount());var e=[this.getRt(),this.getMinRt(),this.getMaxRt(),this.getCount(),t,this.getSatisfied(),this.getTolerated(),this.getFrustrated(),this.getErrorCount()],n={httpcode:this.getErrorCodeDetails(),components:this.getComponentDetails(),logmetric:this.getErrorDetails(),error_rt:this.getErrorRt()};if(this.getBytesInInfo().bytes){var r=this.getBytesInInfo();n.bytes_in=[r.bytes,r.min,r.max,r.count]}if(this.getBytesOutInfo().bytes){var o=this.getBytesOutInfo();n.bytes_out=[o.bytes,o.min,o.max,o.count]}return[e,n]},n.prototype.getTraceInfo=function(){var t={};return t.t_name=u.webTxnPrefix+this.getUrl(),t.http_method_name=this.getMethod(),t.s_time=this.getStartTime(),t.r_time=this.getRt(),t.http_query_str=this.getQueryParam(),t.trace_reason=4,t.db_opn=[],t.loginfo=[],t.method_count=1,t.dt_count=0,t.custom_params=this.getCustomParamsAsStr(),Object.assign(t,this.getTrackerCountInfo()),t.drop_threshold=apmInsightAgentInstance.getThreshold().getTxnTrackerDropThreshold(),this.appendCompInfoInTrace(t),this.getResCode()>0&&(t.httpcode=this.getResCode()),t},n.prototype.getErrorCodeDetails=function(){return this._errorCodeDetails},n.prototype.getMethod=function(){return this._method},n.prototype.getResCode=function(){return this._resCode},n.prototype.getSatisfied=function(){return this._satisfied},n.prototype.getTolerated=function(){return this._tolerated},n.prototype.getFrustrated=function(){return this._frustrated},n.prototype.getQueryParam=function(){return this._queryParam},n.prototype.getBytesInInfo=function(){return this._bytesInInfo},n.prototype.setBytesIn=function(t){this._bytesInInfo={bytes:t,min:t,max:t,count:1}},n.prototype.getBytesOutInfo=function(){return this._bytesOutInfo},n.prototype.setBytesOut=function(t){this._bytesOutInfo={bytes:t,min:t,max:t,count:1}},t.exports=n}.call(this,cachedModules[2486],cachedModules[2486].exports),cachedModules[7784]={exports:{}},function(t,e){function n(t,e){r.call(this,t),this._url=t.uri,this._errst=null}var r=cachedModules[5843].exports,o=require("util"),i=cachedModules[3996].exports,a=cachedModules[8837].exports;o.inherits(n,r),n.prototype.endApiTxn=function(t){this.isTxnIgnored()||(this.updateRtMetric(),this.updateReqCountByErr(t),this.markCompeletd(),this.updateInDataStore())},n.prototype.getMethod=function(){return a.bckgrnd},n.prototype.aggregate=function(t){return this._url=t.getUrl(),t.isErrorTxn()?(this._errorCount+=t.getErrorCount(),this._errorRt+=t.getRt(),void this.aggregateTxnSubResources(t)):void this.aggregateNonErrorTxn(t)},n.prototype.updateInDataStore=function(){var t=i.getBgTxnmetric(),e=apmInsightAgentInstance.getThreshold().getBgTxnSamplingFactor(),r=apmInsightAgentInstance.getThreshold().getBgMetricSize();this.checkAndupdateInDataStore(t,n,e,r)},n.prototype.getFormattedRtData=function(){var t=[this.getRt(),this.getMinRt(),this.getMaxRt(),this.getCount(),this.getErrorCount()],e={components:this.getComponentDetails(),logmetric:this.getErrorDetails(),error_rt:this.getErrorRt()};return[t,e]},n.prototype.getTraceInfo=function(){var t={};return t.t_name=a.bgTxnPrefix+this.getUrl(),t.s_time=this.getStartTime(),t.r_time=this.getRt(),t.trace_reason=4,t.db_opn=[],t.loginfo=[],t.method_count=1,t.dt_count=0,t.custom_params=this.getCustomParamsAsStr(),Object.assign(t,this.getTrackerCountInfo()),t.drop_threshold=apmInsightAgentInstance.getThreshold().getTxnTrackerDropThreshold(),this.appendCompInfoInTrace(t),t},t.exports=n}.call(this,cachedModules[7784],cachedModules[7784].exports),cachedModules[922]={exports:{}},function(t,e){function n(t){t=t||{},this._licenseKey=t.licenseKey||process.env.APMINSIGHT_LICENSE_KEY,this._appId=t.appId,this._insId=t.instanceId||process.env.APMINSIGHT_INSTANCE_ID,this._appName=t.appName,this._behindProxy=t.behindProxy||!1,this._proxyServerHost=t.proxyServerHost,this._proxyServerPort=t.proxyServerPort,this._proxyUserName=t.proxyAuthUser,this._proxyPassword=t.proxyAuthPassword;var e=parseInt(t.port);this._catalyst=!!t.catalyst,this._appPort=e>0?e:80,this._apmHost=t.apmHost||o(t.licenseKey),this._apmPort=t.apmPort||s.collectorPort,this._agentInstalledPath=t.agentInstallPath,this._agentVersion=t.agentVersion,
this._printPayload=!!t.printPayload,this._agentBaseDir=t.agentBaseDir,this._proxyAgent=r(t),this._licenseKeySuffix=i(t.licenseKey),this._writeFileBaseDir=t.dataFilepath||a()}function r(t){if(c.isEmpty(t.proxyServerHost)||c.isEmpty(t.proxyServerPort))return null;var e={host:t.proxyServerHost,port:t.proxyServerPort};c.isEmpty(t.proxyAuthUser)||c.isEmpty(t.proxyAuthPassword)||(e.auth=t.proxyAuthUser+":"+t.proxyAuthPassword);var n=require("https-proxy-agent");return n(e)}function o(t){return c.isEmpty(t)?void 0:t.startsWith("eu_")?s.euCollectorHostName:t.startsWith("cn_")?s.cnCollectorHostName:t.startsWith("in_")?s.indCollectorHostName:t.startsWith("au_")?s.ausCollectorHostName:s.usCollectorHostName}function i(t){if(c.isEmpty(t))return"";var e=t.length;return t.substr(e-12)}function a(){return process.env.APMINSIGHT_DATA_FILE_PATH?process.env.APMINSIGHT_DATA_FILE_PATH:""}var s=cachedModules[8837].exports,c=cachedModules[4747].exports;n.prototype.isConfiguredProperly=function(){return!c.isEmpty(this.getLicenseKey())&&!c.isEmpty(this.getApplicationName())},n.prototype.isAppIdConfigured=function(){return c.isNonEmptyString(this.getAppId())},n.prototype.isInsIdConfigured=function(){return c.isNonEmptyString(this.getInsId())},n.prototype.getLicenseKey=function(){return this._licenseKey},n.prototype.getAppId=function(){return this._appId},n.prototype.getInsId=function(){return this._insId},n.prototype.getApplicationName=function(){return this._appName},n.prototype.setApplicationName=function(t){c.isNonEmptyString(t)&&(this._appName=t)},n.prototype.isBehindProxy=function(){return this._behindProxy},n.prototype.isCatalyst=function(){return this._catalyst},n.prototype.getApplicationPort=function(){return this._appPort},n.prototype.getApmHostName=function(){return this._apmHost},n.prototype.getApmPort=function(){return this._apmPort},n.prototype.getAgentInstalledPath=function(){return this._agentInstalledPath},n.prototype.getAgentVersion=function(){return this._agentVersion},n.prototype.isPrintPayloadEnabled=function(){return this._printPayload},n.prototype.getLicenseKeySuffix=function(){return this._licenseKeySuffix},n.prototype.getBaseDir=function(){return this._agentBaseDir},n.prototype.getWriteFileBaseDir=function(){return this._writeFileBaseDir},n.prototype.updateCollectorInfo=function(t){t&&(this._apmHost=t[s.host]||this._apmHost,this._apmPort=t[s.port]||this._apmPort)},n.prototype.checkAndAddProxyAgent=function(t){this._proxyAgent&&(t.agent=this._proxyAgent)},t.exports={Configuration:n}}.call(this,cachedModules[922],cachedModules[922].exports),cachedModules[7187]={exports:{}},function(t,e){var n=cachedModules[8837].exports,r={};r[n.apdexThKey]=.5,r[n.sqlCaptureKey]=!0,r[n.webTxnsamplingFactorKey]=1,r[n.traceThresholdKey]=2e3,r[n.bgTxnTrackingEnabledKey]=!0,r[n.bgTxnSamplingFactorKey]=1,r[n.bgTxnTraceThKey]=5e3,r[n.bgTxnTraceEnabledKey]=!0,r[n.sqlStracktraceKey]=3,r[n.sqlParametrizeKey]=!0,r[n.distributedTracingKey]=!0,r[n.autoUpgradeKey]=!1,r[n.apdexMetricKey]=250,r[n.dbMetricKey]=500,r[n.bgMetricKey]=100,r[n.traceMetricKey]=30,r[n.txnTrackerDropThKey]=10,r[n.txnTraceExtCountThKey]=30,r[n.logLevel]="DEBUG",r[n.txnSkipListeningKey]=[".css",".js",".gif",".jpg",".jpeg",".bmp",".png",".ico"],t.exports=r}.call(this,cachedModules[7187],cachedModules[7187].exports),cachedModules[9344]={exports:{}},function(t,e){function n(t){return 1e3*t}function r(){this._thresholdMap=i,this._lastModified=null}var o=cachedModules[8837].exports,i=cachedModules[7187].exports,a=cachedModules[4747].exports,s={};s[o.traceThresholdKey]=n,s[o.bgTxnTraceThKey]=n,r.prototype.update=function(t,e){t=t||{},e=e||{},this._thresholdMap=Object.assign(this._thresholdMap,t),this._thresholdMap=Object.assign(this._thresholdMap,e),this.applyConversion(),this.updateSkipTxnListening(e[o.txnSkipListeningKey])},r.prototype.applyConfigForFaas=function(){var t={},e={};t[o.traceThresholdKey]=0,this.update(t,e)},r.prototype.getApdexTh=function(){return this._thresholdMap[o.apdexThKey]},r.prototype.isSqlCaptureEnabled=function(){return this._thresholdMap[o.sqlCaptureKey]},r.prototype.getWebTxnSamplingFactor=function(){return this._thresholdMap[o.webTxnsamplingFactorKey]},r.prototype.getBgTxnSamplingFactor=function(){return this._thresholdMap[o.bgTxnSamplingFactorKey]},r.prototype.getTraceThreshold=function(){return this._thresholdMap[o.traceThresholdKey]},r.prototype.getSqlTraceThreshold=function(){return this._thresholdMap[o.sqlStracktraceKey]},r.prototype.isSqlParameterized=function(){return this._thresholdMap[o.sqlParametrizeKey]},r.prototype.getLastModified=function(){return this._thresholdMap[o.lastModifiedTimeKey]},r.prototype.getApdexMetricSize=function(){return this._thresholdMap[o.apdexMetricKey]},r.prototype.getDbMetricSize=function(){return this._thresholdMap[o.dbMetricKey]},r.prototype.getBgMetricSize=function(){return this._thresholdMap[o.bgMetricKey]},r.prototype.getTraceMetricSize=function(){return this._thresholdMap[o.traceMetricKey]},r.prototype.getLogLevel=function(){return this._thresholdMap[o.logLevel]},r.prototype.getSkipTxnListening=function(){return this._thresholdMap[o.txnSkipListeningKey]},r.prototype.getTxnTrackerDropThreshold=function(){return this._thresholdMap[o.txnTrackerDropThKey]},r.prototype.getTxnTraceExtCallThreshold=function(){return this._thresholdMap[o.txnTraceExtCountThKey]},r.prototype.isBgTxnTrackingEnabled=function(){return this._thresholdMap[o.bgTxnTrackingEnabledKey]},r.prototype.isBgTxnTraceEnabled=function(){return this._thresholdMap[o.bgTxnTraceEnabledKey]},r.prototype.bgTxnTraceTh=function(){return this._thresholdMap[o.bgTxnTraceThKey]},r.prototype.isDistributedTracingEnabled=function(){return this._thresholdMap[o.distributedTracingKey]},r.prototype.updateSkipTxnListening=function(t){if(void 0!==t){var t=t.replace(/\*|\s/g,""),e=t.split(",");this._thresholdMap[o.txnSkipListeningKey]=e}},r.prototype.applyConversion=function(){Object.keys(s).forEach(function(t){var e=this._thresholdMap[t];if(e){var n=s[t];this._thresholdMap[t]=n(e)}},this)},r.prototype.isTxnAllowed=function(t){if(a.isEmpty(t))return!1;var e=t.lastIndexOf(".");if(0>e)return!0;var n=t.substring(e,t.length);return this.getSkipTxnListening().indexOf(n)<0},t.exports={Threshold:r}}.call(this,cachedModules[9344],cachedModules[9344].exports),cachedModules[5982]={exports:{}},function(t,e){function n(t,e,n){t&&n&&e&&v.isFunction(e.forEach)&&e.forEach(function(e){r(t,e,n,e.functionName)})}function r(t,e,n,i){if(Array.isArray(i))return void i.forEach(function(o){r(t,e,n,o)});var a=i.split("."),s=t[a[0]];if(v.isEmpty(s))return void _.info(i+" is undefined in module::"+n);for(var c=1;c<a.length;c++)if(s=s[a[c]],v.isEmpty(s))return void _.info(i+" is undefined in module::"+n);return v.isFunction(s)?(_.info("Instrumenting function ::"+i),void o(t,s,e,n,i)):void _.info(i+" is not a function in module::"+n)}function o(t,e,n,r,o){var a=i(e,n,r,o);if(n.override)return void n.override(t,a);var s=o.split(".");s&&(1===s.length?t[o]=a:2===s.length?t[s[0]][s[1]]=a:3===s.length&&(t[s[0]][s[1]][s[2]]=a))}function i(t,e,n,r){return e.wrapper?e.wrapper(t,e,n,r):a(t,e,n,r)}function a(t,e,n,r){return function(){var o=apmInsightAgentInstance.getCurTxn(),i=apmInsightAgentInstance.getCurTracker();if(!o||o.isCompleted())return t.apply(this,arguments);if(e.sync){var a=n+"."+(e.trackerName||r),c={trackerName:a,component:e.component,sync:!0},p={txn:o,syncParentTracker:i,trackerInfo:c};return d(t,this,arguments,p)}var u={moduleName:n,functionInfo:e,functionName:r,curTxn:o,parentTracker:i};return s(t,this,arguments,u)}}function s(t,e,n,r){var o,i=r.moduleName+"."+(r.functionInfo.trackerName||r.functionName),a=T(n,r.functionInfo.callBackIndex),s={trackerName:i,component:r.functionInfo.component,parent:r.parentTracker};r.functionInfo.trackerType&&(s.isDbTracker=!0);var p=apmInsightAgentInstance.createTracker(s);try{a>=0&&a<n.length?(n[a]=u(n[a],p,r.curTxn),o=t.apply(e,n)):(o=t.apply(e,n),o=c(o,r.curTxn,p))}catch(h){throw apmInsightAgentInstance.handleErrorTracker(p,h),h}finally{apmInsightAgentInstance.setCurTracker(r.parentTracker)}return p&&r.functionInfo.extractInfo&&r.functionInfo.extractInfo(e,n,o,p,r),p&&!p.isCompleted()&&apmInsightAgentInstance.endTracker(p,r.curTxn),o}function c(t,e,n){if(!n||!t||!v.isFunction(t.then))return t;var r=t.then;return t.then=function(){var t=Array.prototype.map.call(arguments,function(t){return v.isFunction(t)?p(t,e,n):t});return r.apply(this,t)},t}function p(t,e,n){return function(){var r=apmInsightAgentInstance.getCurTxn(),o=apmInsightAgentInstance.getCurTracker();if(e=r?r:e,!e||e.isCompleted())return t.apply(this,arguments);x(n,e,arguments);try{return apmInsightAgentInstance.setCurContext(e,n),t.apply(this,arguments)}catch(i){throw i}finally{apmInsightAgentInstance.setCurContext(r,o)}}}function u(t,e,n){return function(){return h(this,arguments,t,n,e)}}function h(t,e,n,r,o){if(!r||r.isCompleted())return n.apply(t,e);var i=v.isEmpty(n.name)?"Anonymous":n.name,a={trackerName:"Callback:"+i,sync:!0},s={txn:r,asyncParentTracker:o,trackerInfo:a};d(n,t,e,s)}function d(t,e,n,r){try{x(r.asyncParentTracker,r.txn,n);var o=apmInsightAgentInstance.getCurTxn(),i=apmInsightAgentInstance.getCurTracker(),a=r.syncParentTracker?r.syncParentTracker:r.asyncParentTracker;apmInsightAgentInstance.setCurContext(r.txn,a),r.trackerInfo.parent=a;var s=apmInsightAgentInstance.createTracker(r.trackerInfo),c=t.apply(e,n);return apmInsightAgentInstance.endTracker(s),c}catch(p){throw apmInsightAgentInstance.handleErrorTracker(s,p),p}finally{apmInsightAgentInstance.setCurContext(o,i)}}function l(t){return function(e,n){return e instanceof C.IncomingMessage&&n instanceof C.ServerResponse?g(t,this,arguments,e,n):m(t,this,arguments)}}function g(t,e,n,r,o){var i=t.name?t.name:"Anonymous";return apmInsightAgentInstance.createTxn(r,o,i),f(t,e,n)}function f(t,e,n){try{var r=t.apply(e,n);return apmInsightAgentInstance.endContextTracker(),r}catch(o){throw apmInsightAgentInstance.endContextTracker(o),o}finally{apmInsightAgentInstance.clearCurContext()}}function m(t,e,n){var r=v.isNonEmptyString(t.name)?t.name:"Anonymous",o={uri:r,rootListner:r},i=new A(o);apmInsightAgentInstance.setCurContext(i,i.getRootTracker());try{var a=T(n);a>=0&&(n[a]=y(n,i));var s=t.apply(e,n);return apmInsightAgentInstance.endContextTracker(),I(s,i)}catch(c){throw c}}function y(t,e){return function(n){return e.endApiTxn(n),t.apply(this,arguments)}}function I(t,e){return t&&v.isFunction(t.then)?t.then(function(t){return t},function(t){throw t}):t}function x(t,e,n){t&&(n&&n[0]&&n[0]instanceof Error&&t.setError(n[0],e),apmInsightAgentInstance.endTracker(t,e))}function T(t,e){if(!t||t.length<=0)return-1;if(void 0===e){if(v.isFunction(t[t.length-1]))return t.length-1}else if(t.length>e&&v.isFunction(t[e]))return e;return-1}var v=cachedModules[4747].exports,_=cachedModules[6725].exports,C=require("http"),A=cachedModules[7784].exports;t.exports={checkAndWrapModule:n,wrapCaller:a,wrapCallBack:u,invokeAsyncOpn:s,invokeSyncOpn:d,getCallBackIndex:T,checkAndWrapPromise:c,wrapAndMonitorFunction:l,monitorStandAloneFunction:m,handleRootTrackerInvocation:f}}.call(this,cachedModules[5982],cachedModules[5982].exports),cachedModules[4782]={exports:{}},function(t,e){function n(t,e){try{if(t&&t.stream&&t.stream.session)if(t.stream.apminsightTxn)t.stream.apminsightTxn.endRootTracker();else{var n="emit - request",r=apmInsightAgentInstance.createTxn(t,e,n);t.stream.apminsightTxn=r,t.stream.session.apminsightTxn=r,o.checkAndWrapModule(t.stream,a.stream,"Http2Stream"),o.checkAndWrapModule(t.session,a.session,"Http2Session"),apmInsightAgentInstance.endRootTracker(),apmInsightAgentInstance.clearCurContext()}}catch(i){}}function r(t,e){return function(n,r){try{var o,a=n.apminsightTxn;if(a&&!a.isCompleted()){apmInsightAgentInstance.setCurContext(n.apminsightTxn);var s=i.isEmpty(t.name)?"Anonymous":t.name,c="emit - "+e+" - "+s,p={trackerName:c,sync:!0};o=apmInsightAgentInstance.createTracker(p)}var u=t.apply(this,arguments);return apmInsightAgentInstance.endTracker(o),u}catch(h){throw apmInsightAgentInstance.handleErrorTracker(o,h),h}finally{apmInsightAgentInstance.clearCurContext()}}}var o=cachedModules[5982].exports,i=cachedModules[4747].exports,a={stream:[{functionName:["close","setTimeout"]}],session:[{functionName:["close","ping","setTimeout"]}]};t.exports={handleHttp2Request:n,handleHttp2StreamOrSession:r}}.call(this,cachedModules[4782],cachedModules[4782].exports),cachedModules[9852]={exports:{}},function(t,e){function n(t){return function(e,n){f.isFunction(e)?arguments[0]=i(e):f.isFunction(n)&&(arguments[1]=i(n));var o=t.apply(this,arguments);return r(o),o}}function r(t){if(t&&f.isFunction(t.on)){var e=t.on;t.on=function(t,n){return"request"===t&&f.isFunction(n)&&(arguments[1]=i(n)),e.apply(this,arguments)}}}function o(t){return function(e,n){f.isFunction(n)&&(arguments[1]=i(n));var r=t.apply(this,arguments);if(r&&r.on){r.on("request",y.handleHttp2Request);var o=r.on;r.on=function(t,e){return"stream"!==t&&"session"!==t||!f.isFunction(e)||(arguments[1]=y.handleHttp2StreamOrSession(e,t)),o.apply(this,arguments)}}return r}}function i(t){return function(e,n){if(!e)return t.apply(this,arguments);var r=f.isEmpty(t.name)?"Anonymous":t.name;if(e.apminsightTxn)try{var o="emit - request - "+r,i={trackerName:o,sync:!0},a={txn:e.apminsightTxn,trackerInfo:i};return m.invokeSyncOpn(t,this,arguments,a)}catch(s){throw s}finally{apmInsightAgentInstance.clearCurContext()}var c="request - handler - "+r,p=apmInsightAgentInstance.createTxn(e,n,c);e.apminsightTxn=p,e.stream&&e.stream.session&&(e.stream.apminsightTxn=p,e.stream.session.apminsightTxn=p);try{var u=t.apply(this,arguments);return apmInsightAgentInstance.endRootTracker(),u}catch(h){apmInsightAgentInstance.endRootTracker(h)}finally{apmInsightAgentInstance.clearCurContext()}}}function a(t,e,n,r){return function(){var o=apmInsightAgentInstance.getCurTxn();if(!o||o.isCompleted())return t.apply(this,arguments);var i=apmInsightAgentInstance.getCurTracker(),a=i&&"WEBREQUEST"===i.getComponent();if(a)return t.apply(this,arguments);var c={curTxn:o,parentTracker:i,moduleName:n,functionInfo:e,functionName:r};return s(arguments),m.invokeAsyncOpn(t,this,arguments,c)}}function s(t){if(apmInsightAgentInstance.getThreshold().isDistributedTracingEnabled()&&t&&t.length>0&&"object"==typeof t[0]){var e=t[0];e.headers||(e.headers={}),e.headers[g.crossAppReqHeader]=apmInsightAgentInstance.getConfig().getLicenseKeySuffix()}}function c(t,e){t&&"function"==typeof t.on&&t.on("response",function(t){if(t&&t.headers){e.updateInfo({statusCode:t.statusCode});var n=t.headers[g.crossAppResHeaderLower];if(f.isNonEmptyString(n))try{n=JSON.parse(n),e.updateDtInfo(n)}catch(r){}}})}function p(t,e,n,r,o){if(c(n,r),e&&0!=e.length){var i=e[0],a={};if("string"==typeof i){a.url=i;var s=I.parse(i);s&&s.hostname&&(a.host=s.hostname,a.port=s.port?s.port:"http"===o.moduleName?80:443)}else if("object"==typeof i){var p=i.hostname||i.host;a.host=p,a.port=i.port?i.port:"http"===o.moduleName?80:443,a.url=p+i.path,a.method=i.method}r.updateInfo(a)}}function u(t){return function(e,n){var r=apmInsightAgentInstance.getCurTxn();return!r||r.isCompleted()?(this._apmInsightAgentTxnContext=null,t.apply(this,arguments)):(this._apmInsightAgentTxnContext=r,!this._apmEmitWrapped&&f.isFunction(this.emit)&&(this.emit=h(this.emit),this._apmEmitWrapped=!0),t.apply(this,arguments))}}function h(t){return function(e){var n=this._apmInsightAgentTxnContext;if(!n||n.isCompleted())return t.apply(this,arguments);var r="emit - "+e,o={trackerName:r,sync:!0},i={txn:n,trackerInfo:o};return m.invokeSyncOpn(t,this,arguments,i)}}function d(t){return function(e){var n=apmInsightAgentInstance.getCurTxn();if(!n||n.isCompleted())return t.apply(this,arguments);if(!f.isFunction(e))return t.apply(this,arguments);var r=apmInsightAgentInstance.getCurTracker();return arguments[0]=l(arguments[0],n,r),t.apply(this,arguments)}}function l(t,e,n){return function(){try{return apmInsightAgentInstance.setCurContext(e,n),t.apply(this,arguments)}finally{apmInsightAgentInstance.clearCurContext()}}}var g=cachedModules[8837].exports,f=cachedModules[4747].exports,m=cachedModules[5982].exports,y=cachedModules[4782].exports,I=require("url"),x={events:[{functionName:"prototype.addListener",wrapper:u,override:function(t,e){t.prototype.addListener=e,t.prototype.on=e}}],http:[{functionName:"createServer",wrapper:n},{functionName:"Server",wrapper:n},{functionName:"request",component:"WEBREQUEST",wrapper:a,extractInfo:p},{functionName:"get",component:"WEBREQUEST",wrapper:a,extractInfo:p}],https:[{functionName:"createServer",wrapper:n},{functionName:"Server",wrapper:n},{functionName:"request",component:"WEBREQUEST",wrapper:a,extractInfo:p},{functionName:"get",component:"WEBREQUEST",wrapper:a,extractInfo:p}],http2:[{functionName:"createSecureServer",wrapper:o},{functionName:["Http2ServerRequest.prototype.setTimeout","Http2ServerResponse.prototype.end","Http2ServerResponse.prototype.setTimeout","Http2ServerResponse.prototype.createPushResponse"]}],net:[{functionName:["Server.prototype.getConnections","Server.prototype.close","Server.prototype.listen","Socket.prototype.setTimeout","Socket.prototype.write","Socket.prototype.connect","createConnection"]}],fs:[{functionName:["access","ftruncate","mkdir","mkdtemp","readdir","readFile","readlink","realpath","truncate","appendFile","symlink","copyFile","open","writeFile","chmod","fchmod","lchmod","link","rename","chown","fchown","lchown","futimes","utimes","close","exists","fdatasync","fstat","fsync","lstat","stat","rmdir","unlink","read","write","realpath.native"]}],dns:[{functionName:["lookupService","lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNaptr","resolveNs","resolvePtr","resolveSoa","resolveSrv","resolveTxt","resolveAny","reverse"]}],crypto:[{functionName:["pbkdf2","randomBytes","randomFill","generateKeyPair","scrypt"]}],domain:[{functionName:["Domain.prototype.bind","Domain.prototype.intercept"]}],zlib:[{functionName:["Deflate.prototype.close","Inflate.prototype.close","Gzip.prototype.close","Gunzip.prototype.close","DeflateRaw.prototype.close","InflateRaw.prototype.close","Unzip.prototype.close","Deflate.prototype.flush","Inflate.prototype.flush","Gzip.prototype.flush","Gunzip.prototype.flush","DeflateRaw.prototype.flush","InflateRaw.prototype.flush","Unzip.prototype.flush","Deflate.prototype.params","deflate","deflateRaw","gunzip","gzip","inflate","inflateRaw","unzip"]}],child_process:[{functionName:["exec","execFile"]}],cluster:[{functionName:["disconnect","Worker.prototype.send"]}],process:[{functionName:"send"},{functionName:"nextTick",wrapper:d}],dgram:[{functionName:["Socket.prototype.bind","Socket.prototype.close","Socket.prototype.send","createSocket"]}],tls:[{functionName:["connect","TLSSocket.prototype.renegotiate"]}],stream:[{functionName:["Writable.prototype.write","Writable.prototype.end","finished","pipeline"]}],global:[{functionName:["setImmediate","setTimeout"],callBackIndex:0}],inspector:[{functionName:["Session.prototype.post"]}],worker_threads:[{functionName:["Worker.prototype.terminate"]}],readline:[{functionName:["Interface.prototype.question"]}]};t.exports={MODULES_INFO:x}}.call(this,cachedModules[9852],cachedModules[9852].exports),cachedModules[7948]={exports:{}},function(t,e){function n(t){return function(){var e=t.apply(this,arguments);return u.checkAndWrapModule(e,g,d),e}}function r(t){return function(){var e=t.apply(this,arguments);return u.checkAndWrapModule(e,f,d),o(e),e}}function o(t){t&&h.isFunction(t.on)&&(t.apmInsightAgentInstrumented||(t.on("connection",function(t){u.checkAndWrapModule(t,g,d)}),t.apmInsightAgentInstrumented=!0))}function i(t){return function(){var e=t.apply(this,arguments);return u.checkAndWrapModule(result,m,d),e}}function a(t){return function(){var e=t.apply(this,arguments);if(h.isObject(this._nodes)){var n=this._nodes;Object.keys(n).forEach(function(t){h.isObject(n[t])&&o(n[t].pool)})}return e}}function s(t,e,n,r){if(t){var o={};t.host&&t.port&&(o.host=t.host,o.port=t.port);var i=t.config;i&&i.host&&i.port?(o.host=i.host,o.port=i.port):i.connectionConfig&&i.connectionConfig.host&&i.connectionConfig.port&&(o.host=i.connectionConfig.host,o.port=i.connectionConfig.port),r.updateInfo(o)}}function c(t,e,n,r){s(t,e,n,r);var o=apmInsightAgentInstance.getThreshold(),i={};if(o.isSqlCaptureEnabled()&&e&&e.length>0){var a=e[0];"string"==typeof a?i.query=a:"object"==typeof a&&(i.query=a.sql)}if(n&&h.isFunction(n._callback)){var c=apmInsightAgentInstance.getCurTxn();n._callback=u.wrapCallBack(n._callback,r,c)}r.updateInfo(i)}var p=cachedModules[8837].exports,u=cachedModules[5982].exports,h=cachedModules[4747].exports,d="mysql",l={functions:[{functionName:"createConnection",wrapper:n},{functionName:"createPool",wrapper:r},{functionName:"createPoolCluster",wrapper:i},{functionName:"Client.prototype.connect",component:"MYSQL"},{functionName:"Client.prototype.query",component:"MYSQL",extractInfo:c,trackerType:p.dbTracker},{functionName:"Client.prototype._connect",component:"MYSQL"}]},g=[{functionName:"query",component:"MYSQL",extractInfo:c,trackerType:p.dbTracker},{functionName:"connect",component:"MYSQL",extractInfo:s},{functionName:"changeUser",component:"MYSQL"},{functionName:"beginTransaction",component:"POJSO"},{functionName:"commit",component:"MYSQL"},{functionName:"rollback",component:"POJSO"},{functionName:"ping",component:"MYSQL"},{functionName:"end",component:"MYSQL"}],f=[{functionName:"getConnection",component:"MYSQL"},{functionName:"acquireConnection",component:"POJSO"},{functionName:"end",component:"MYSQL"},{functionName:"query",component:"MYSQL"}],m=[{functionName:"add",wrapper:a},{functionName:"getConnection",component:"MYSQL"}];t.exports=l}.call(this,cachedModules[7948],cachedModules[7948].exports),cachedModules[2382]={exports:{}},function(t,e){function n(t,e){var n={};if(!t)return n;t.host&&t.port&&(n.host=t.host,n.port=t.port);var r=t.options;return r&&r.host&&r.port&&(n.host=r.host,n.port=r.port),n}function r(t,e,r,o){var i=n(t,e),a=apmInsightAgentInstance.getThreshold();if(a.isSqlCaptureEnabled()&&e&&e.length>0){var s=e[0];"string"==typeof s?i.query=s:"object"==typeof s&&(i.query=s.text)}o.updateInfo(i)}var o=cachedModules[8837].exports,i={functions:[{functionName:"Client.prototype.connect",component:"PGSQL"},{functionName:"Client.prototype.query",component:"PGSQL",extractInfo:r,trackerType:o.dbTracker},{functionName:"Pool.prototype.connect",component:"PGSQL"},{functionName:"Pool.prototype.query",component:"PGSQL",extractInfo:r,trackerType:o.dbTracker},{functionName:"Pool.prototype.end",component:"POJSO"},{functionName:"connect",component:"POJSO"}]};t.exports=i}.call(this,cachedModules[2382],cachedModules[2382].exports),cachedModules[5854]={exports:{}},function(t,e){function n(t){return function(){if(arguments)for(var e=0;e<arguments.length;e++)arguments[e]&&c.isFunction(arguments[e])?arguments[e]=o(arguments[e]):Array.isArray(arguments[e])&&(arguments[e]=r(arguments[e]));return t.apply(this,arguments)}}function r(t){var e;if(t){e=[];for(var n=0;n<t.length;n++)t[n]&&c.isFunction(t[n])?e.push(o(t[n])):Array.isArray(t[n])?e.push(r(t[n])):e.push(t[n])}return e}function o(t){return t.length>3?function(e,n,r,o){return i(this,t,arguments)}:function(e,n,r){return i(this,t,arguments)}}function i(t,e,n){var r=apmInsightAgentInstance.getCurTxn();if(!r||r.isCompleted())return e.apply(t,n);var o=apmInsightAgentInstance.getCurTracker(),i=e.name?e.name:"Anonymous",a="EXPRESS - MIDDLEWARE -"+i,c={trackerName:a,component:u,sync:!0},p={txn:r,syncParentTracker:o,trackerInfo:c};s.invokeSyncOpn(e,t,n,p)}function a(t,e,n,r,o){if(e&&0!=e.length){var i={};e[0]&&"string"==typeof e[0]?i.url=e[0]:e.length>1&&e[1]&&"string"==typeof e[1]&&(i.url=e[1]),r.updateInfo(i)}}var s=cachedModules[5982].exports,c=cachedModules[4747].exports,p="EXPRESS",u="MIDDLEWARE",h={functions:[{functionName:"application.render",component:p},{functionName:"response.json",component:p,sync:!0},{functionName:"response.jsonp",component:p,sync:!0},{functionName:"response.redirect",component:p,sync:!0,extractInfo:a},{functionName:"response.render",component:p},{functionName:"response.send",sync:!0,component:p},{functionName:"response.sendFile",component:p}]},d=["application","Router"],l=["checkout","copy","delete","get","head","lock","merge","mkactivity","mkcol","move","m-search","notify","options","patch","post","purge","put","report","search","subscribe","trace","unlock","unsubscribe","use","all","param"];d.forEach(function(t){l.forEach(function(e){var r={};r.functionName=t+"."+e,r.wrapper=n,r.component=u,h.functions.push(r)})}),t.exports=h}.call(this,cachedModules[5854],cachedModules[5854].exports),cachedModules[5381]={exports:{}},function(t,e){function n(t){return function(e){try{var n,p=apmInsightAgentInstance.getCurTracker();if(e&&s.isFunction(e)){var u=e();if(o(u)){var h=c+" - "+u.type+" - "+u.key,d={trackerName:h,component:c,parent:p};n=apmInsightAgentInstance.createTracker(d),u.callback=i.wrapCallBack(u.callback,n,apmInsightAgentInstance.getCurTxn()),arguments[0]=function(){return u},r(n,this,u)}}var l=t.apply(this,arguments);return l}catch(g){throw a.error("memcache command handler",g),apmInsightAgentInstance.handleErrorTracker(n,g),g}finally{apmInsightAgentInstance.setCurTracker(p)}}}function r(t,e,n){if(t&&e){var r;if(e.servers&&"string"==typeof e.servers?r=e.servers.split(":"):e.HashRing&&e.HashRing.get&&e.HashRing.get(n.key)&&(r=e.HashRing.get(n.key).split(":")),r&&2===r.length){var o={};o.host=r[0],o.port=r[1],t.updateInfo(o)}}}function o(t){return t&&t.type&&t.key&&s.isFunction(t.callback)}var i=cachedModules[5982].exports,a=cachedModules[6725].exports,s=cachedModules[4747].exports,c="MEMCACHED",p={functions:[{functionName:"prototype.command",wrapper:n}]};t.exports=p}.call(this,cachedModules[5381],cachedModules[5381].exports),cachedModules[6335]={exports:{}},function(t,e){function n(t,e,n){e.forEach(function(e){var r=t+".prototype."+e,o={functionName:r,component:p,extractInfo:n,trackerType:s.dbTracker};d.functions.push(o)})}function r(t,e,n,r){var o={};t.databaseName&&(o.object=t.databaseName),a(t.topology)&&(o.host=t.topology.host,o.port=t.topology.port),r.updateInfo(o)}function o(t,e,n,r){var o={};t.namespace&&(o.object=t.namespace),t.s&&a(t.s.topology)&&(o.host=t.s.topology.host,o.port=t.s.topology.port),r.updateInfo(o)}function i(t,e,n,r){let i=apmInsightAgentInstance.getCurTxn();o(t,e,n,r),n&&c.isFunction(n.on)&&(n.on("end",function(){r.endTracker(i)}),n.on("close",function(){r.endTracker(i)}),n.on("error",function(t){r.setError(t,i)}))}function a(t){return t&&t.host&&t.port}var s=cachedModules[8837].exports;const c=cachedModules[4747].exports;var p="MONGODB",u=["createCollection","stats","command","eval","collection","renameCollection","dropCollection","dropDatabase","collections","createIndex","ensureIndex","addUser","removeUser","authenticate","indexInformation"],h=["insertOne","insertMany","bulkWrite","insert","updateOne","replaceOne","updateMany","update","deleteOne","deleteMany","remove","save","rename","drop","options","isCapped","createIndex","createIndexes","dropIndex","dropIndexes","reIndex","ensureIndex","indexExists","indexInformation","count","distinct","indexes","stats","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","findAndModify","findAndRemove","aggregate","parallelCollectionScan","geoNear","geoHaystackSearch","group","mapReduce"],d={functions:[{functionName:"MongoClient.connect"},{functionName:["Db.prototype.open","Db.prototype.close","Db.prototype.logout","Db.prototype.executeDbAdminCommand"],component:p},{functionName:"Collection.prototype.find",trackerType:s.dbTracker,component:p,extractInfo:i}]};n("Db",u,r),n("Collection",h,o),t.exports=d}.call(this,cachedModules[6335],cachedModules[6335].exports),cachedModules[6383]={exports:{}},function(t,e){function n(){}function r(t){return function(e){var r=apmInsightAgentInstance.getCurTxn();if(!r||r.isCompleted()||u.isEmpty(e.command))return t.apply(this,arguments);var o=apmInsightAgentInstance.getCurTracker(),a=d+" - "+e.command.toUpperCase(),s={trackerName:a,component:d,stale:!0,parent:o},c=apmInsightAgentInstance.createTracker(s),l=e.callback&&e.callback!=n?e.callback:n;e.callback=p.wrapCallBack(l,c,r),arguments[0]=e,i(c,this);try{return t.apply(this,arguments)}catch(g){throw h.error("redis internal command handler",g),apmInsightAgentInstance.handleErrorTracker(c,g),g}finally{apmInsightAgentInstance.setCurTracker(o)}}}function o(t){return function(e){var n=apmInsightAgentInstance.getCurTxn();if(!n||n.isCompleted()||u.isEmpty(e)||"string"!=typeof e)return t.apply(this,arguments);var r=p.getCallBackIndex(arguments),o=apmInsightAgentInstance.getCurTracker(),a=d+" - "+e.toUpperCase(),s={trackerName:a,component:d,stale:!0},c=apmInsightAgentInstance.createTracker(s);i(c,this);try{if(0>r){var l=t.apply(this,arguments);return l=p.checkAndWrapPromise(l,n,c)}var g=p.wrapCallBack(arguments[r],c,n);return arguments[r]=g,t.apply(this,arguments)}catch(f){throw h.error("redis send command handler",f),apmInsightAgentInstance.handleErrorTracker(c,f),f}finally{apmInsightAgentInstance.setCurTracker(o)}}}function i(t,e){t&&t.updateInfo(a(e))}function a(t){var e={};return t?(t.port&&t.host?(e.host=t.host,e.port=t.port):t.options&&t.options.host&&t.options.port?(e.host=t.options.host,e.port=t.options.port):t.connection_options&&t.connection_options.host&&t.connection_options.port?(e.host=t.connection_options.host,e.port=t.connection_options.port):t.connectionOption&&t.connectionOption.host&&t.connectionOption.port&&(e.host=t.connectionOption.host,e.port=t.connectionOption.port),e):e}function s(t){return function(){var e=apmInsightAgentInstance.getCurTracker();return c(e)&&e.setActive(),t.apply(this,arguments)}}function c(t){return t&&t.getComponent()===d}var p=cachedModules[5982].exports,u=cachedModules[4747].exports,h=cachedModules[6725].exports,d="REDIS",l={functions:[{functionName:["RedisClient.prototype.internal_send_command"],wrapper:r},{functionName:["RedisClient.prototype.write"],wrapper:s},{functionName:["RedisClient.prototype.send_command"],wrapper:o}]};t.exports=l}.call(this,cachedModules[6383],cachedModules[6383].exports),cachedModules[4153]={exports:{}},function(t,e){function n(t){return function(){var e=apmInsightAgentInstance.getCurTxn(),n=apmInsightAgentInstance.getCurTracker();if(!e||e.isCompleted())return t.apply(this,arguments);var o,i=a.getCallBackIndex(arguments),s={trackerName:"innerExecute",component:c,isDbTracker:!0,parent:n},p=apmInsightAgentInstance.createTracker(s),u=apmInsightAgentInstance.getThreshold();if(u.isSqlCaptureEnabled()&&p&&"string"==typeof arguments[0]){var h={};h.query=arguments[0],p.updateInfo(h)}try{i>0?(arguments[i]=r(arguments[i],p,e),o=t.apply(this,arguments)):(o=t.apply(this,arguments),o=a.checkAndWrapPromise(o,e,p))}catch(d){throw apmInsightAgentInstance.handleErrorTracker(p,d),d}finally{apmInsightAgentInstance.setCurTracker(n)}return o}}function r(t,e,n){return function(r,i){if(!n||n.isCompleted())return t.apply(this,arguments);o(r,i,e,n);var c=s.isEmpty(t.name)?"Anonymous":t.name,p={trackerName:"Callback:"+c,sync:!0},u={txn:n,asyncParentTracker:e,trackerInfo:p};return a.invokeSyncOpn(t,this,arguments,u)}}function o(t,e,n,r){n&&(t&&t instanceof Error?(n.setError(t,r),i(t.coordinator,n)):e&&e.info&&i(e.info.queriedHost,n))}function i(t,e){if(t&&"string"==typeof t&&t.indexOf(":")>0){var n=t.split(":");if(n&&n.length>1){var r={};r.host=n[0],r.port=n[1],e.updateInfo(r)}}}var a=cachedModules[5982].exports,s=cachedModules[4747].exports,c="CASSANDRA",p={functions:[{functionName:"Client.prototype._innerExecute",wrapper:n},{functionName:["Client.prototype.connect","Client.prototype.shutdown","Client.prototype.batch"],component:c}]};t.exports=p}.call(this,cachedModules[4153],cachedModules[4153].exports),cachedModules[3735]={exports:{}},function(t,e){function n(t,e,n,o){var i=r(t,e),a=apmInsightAgentInstance.getThreshold();
if(a.isSqlCaptureEnabled()&&e&&e.length>0){var s=e[0];"string"==typeof s?i.query=s:"object"==typeof s&&(i.query=s.sql)}o.updateInfo(i)}function r(t,e){var n={};try{t&&t.config.host&&t.config.port&&(n.host=t.config.host,n.port=t.config.port)}catch(r){}return n}var o=cachedModules[8837].exports,i="MYSQL",a={functions:[{functionName:["Connection.prototype.query","Connection.prototype.execute"],component:i,trackerType:o.dbTracker,extractInfo:n}]};t.exports=a}.call(this,cachedModules[3735],cachedModules[3735].exports),cachedModules[9124]={exports:{}},function(t,e){function n(t){let e={};return t?(t.collectionName&&(e.object=t.collectionName),t.conn&&(e.host=t.conn.host,e.port=t.conn.port),e):e}function r(t,e,r,o){var i;t.__proto__&&(i=t.__proto__.collection),!i&&t.prototype&&(i=t.prototype.collection),o.updateInfo(n(i))}var o=cachedModules[8837].exports,i=(cachedModules[4747].exports,"MONGODB"),a={functions:[{functionName:["Model.countDocuments","Model.createIndexes","Model.findOneAndRemove","Model.geoSearch","Model.listIndexes","Model.ensureIndexes"],trackerType:o.dbTracker,component:i,extractInfo:r},{functionName:["Model.init","Model.startSession","Model.estimatedDocumentCount"],component:i,extractInfo:r}]};t.exports=a}.call(this,cachedModules[9124],cachedModules[9124].exports),cachedModules[8835]={exports:{}},function(t,e){function n(t){return function(e){var n=apmInsightAgentInstance.getCurTxn();if(!n||n.isCompleted())return t.apply(this,arguments);if(!e||!e.name)return t.apply(this,arguments);var r=apmInsightAgentInstance.getCurTracker(),i=c+" - "+e.name,p={trackerName:i,component:c,stale:!0,parent:r},u=apmInsightAgentInstance.createTracker(p);o(this,u);try{var h=t.apply(this,arguments);return h=a.checkAndWrapPromise(h,n,u)}catch(d){throw s.error("ioredis send command handler",d),apmInsightAgentInstance.handleErrorTracker(u,d),d}finally{apmInsightAgentInstance.setCurTracker(r)}}}function r(t){return function(){var e=apmInsightAgentInstance.getCurTracker();return i(e)&&e.setActive(),t.apply(this,arguments)}}function o(t,e){try{if(t&&e){var n={};n.host=t.options.host,n.port=t.options.port,e.updateInfo(n)}}catch(r){}}function i(t){return t&&t.getComponent()===c}var a=cachedModules[5982].exports,s=cachedModules[6725].exports,c="REDIS",p={functions:[{functionName:["prototype.sendCommand"],wrapper:n},{functionName:["Command.prototype.toWritable"],wrapper:r}]};t.exports=p}.call(this,cachedModules[8835],cachedModules[8835].exports),cachedModules[7756]={exports:{}},function(t,e){function n(t,e,n,o){r(t,e,n,o);var i=apmInsightAgentInstance.getThreshold(),a={};if(i.isSqlCaptureEnabled()&&e&&e.length>0){var s=e[0];"string"==typeof s?a.query=s:"object"==typeof s&&(a.query=s.sql)}o.updateInfo(a)}function r(t,e,n,r){if(t){var o={},i=t.parent||t;if(i&&i.config){var a=i.config;if(!s.isNonEmptyString(a.server))return;o.host=a.server,o.port=s.isPositiveNumber(a.port)?a.port:1433}r.updateInfo(o)}}function o(t,e,n,r){if(e){var o={};!s.isEmpty(e[0])&&s.isNonEmptyString(e[0].server)&&(o.host=e[0].server,o.port=s.isPositiveNumber(e[0].port)?e[0].port:1433,r.updateInfo(o))}}function i(t,e,n,o){if(r(t,e,n,o),e){var i={};try{if(e&&s.isNonEmptyString(e[0])){i.opn="EXECUTE",i.object=e[0];var a="exec "+e[0],p=t.parameters;p&&(Object.keys(p).forEach(function(t){var e=p[t];a+=s.isTypeNumber(e.value)?" @"+e.name+" = "+e.value+" , ":" @"+e.name+" = '"+e.value+"' , "}),a=a.replace(/,\s*$/,"")),i.query=a}}catch(u){c.error("Exception occured while capturing stored procedure call",u)}o.updateInfo(i)}}var a=cachedModules[8837].exports,s=cachedModules[4747].exports,c=cachedModules[6725].exports,p="MSSQL",u={functions:[{functionName:"connect",component:p,extractInfo:o},{functionName:"ConnectionPool.prototype.connect",component:p,extractInfo:r},{functionName:["Request.prototype.query","Request.prototype.batch"],component:p,extractInfo:n,trackerType:a.dbTracker},{functionName:"Request.prototype.execute",component:p,extractInfo:i,trackerType:a.dbTracker},{functionName:"Request.prototype.bulk",component:p},{functionName:["Transaction.prototype.begin","Transaction.prototype.commit","Transaction.prototype.rollback"],component:p},{functionName:["PreparedStatement.prototype.prepare","PreparedStatement.prototype.execute","PreparedStatement.prototype.unprepare"],component:p}]};t.exports=u}.call(this,cachedModules[7756],cachedModules[7756].exports),cachedModules[3251]={exports:{}},function(t,e){function n(t,e,n,r){var o={},i=apmInsightAgentInstance.getThreshold();if(i.isSqlCaptureEnabled()&&e&&e.length>0){var a=e[0];"string"==typeof a&&(o.query=a)}r.updateInfo(o)}var r=cachedModules[8837].exports;const o="ORACLEDB";var i={functions:[{functionName:["Connection.prototype.execute","Connection.prototype.executeMany"],component:o,extractInfo:n,trackerType:r.dbTracker}]};collectionMethods=["find","createIndex","drop","dropIndex","insertMany","insertManyAndGet","insertOne","insertOneAndGet","getDataGuide"],databaseMethods=["createCollection","getCollectionNames","openCollection","createDocument"],operationMethods=["remove","replaceOne","replaceOneAndGet"],t.exports=i}.call(this,cachedModules[3251],cachedModules[3251].exports),cachedModules[5895]={exports:{}},function(t,e){var n=cachedModules[7948].exports,r=cachedModules[2382].exports,o=cachedModules[5854].exports,i=cachedModules[5381].exports,a=cachedModules[6335].exports,s=cachedModules[6383].exports,c=cachedModules[4153].exports,p=cachedModules[3735].exports,u=cachedModules[9124].exports,h=cachedModules[8835].exports,d=cachedModules[7756].exports,l=cachedModules[3251].exports;t.exports={mysql:n,pg:r,express:o,memcached:i,mongodb:a,redis:s,mysql2:p,mongoose:u,ioredis:h,mssql:d,oracledb:l,"cassandra-driver":c}}.call(this,cachedModules[5895],cachedModules[5895].exports),cachedModules[7395]={exports:{}},function(t,e){function n(t){r(),o(),a()}function r(){var t=c.MODULES_INFO;Object.keys(t).forEach(function(e){try{var n="global"===e?global:require(e)}catch(r){return void p.info("module ::"+e+" is not available")}p.info("Instrumenting module::",e),h.checkAndWrapModule(n,t[e],e)})}function o(){s._load=function(t,e,n){var r=d.apply(this,arguments);return g.indexOf(t)<0?r:i(t,r)}}function i(t,e,n){if(l[t]&&l[t].wrapped)return l[t].wrapped;p.info("Instrumenting module::"+t);var r;if(n){var o=u[n];r=o[t]}else n=t,r=u[n];return h.checkAndWrapModule(e,r,n),l[t]={},l[t].wrapped=e,e}function a(){try{var t=require("async_hooks"),e={};t.createHook({init:function(t,n,r,o){var i=apmInsightAgentInstance.getCurTxn();i&&"PROMISE"===n&&(e[t]={txn:i,tracker:apmInsightAgentInstance.getCurTracker()})},before:function(t){if(e[t]){var n=e[t];apmInsightAgentInstance.setCurContext(n.txn,n.tracker)}},after:function(t){e[t]&&(apmInsightAgentInstance.getConfig().isCatalyst()||apmInsightAgentInstance.clearCurContext())},destroy:function(t){e[t]&&delete e[t]}}).enable()}catch(n){p.info("Async hook module is not available")}}var s=require("module"),c=cachedModules[9852].exports,p=cachedModules[6725].exports,u=cachedModules[5895].exports,h=cachedModules[5982].exports,d=s._load,l={},g=Object.keys(u);t.exports={start:n}}.call(this,cachedModules[7395],cachedModules[7395].exports),cachedModules[1562]={exports:{}},function(t,e){function n(t,e,n){var i=apmInsightAgentInstance.getConfig(),a=apmInsightAgentInstance.getInsInfo(),s={host:i.getApmHostName(),port:i.getApmPort(),path:t+"?"+o.licenseKey+"="+i.getLicenseKey()+"&"+o.instance_Id+"="+a.getInstanceId(),method:o.requestMethod,rejectUnauthorized:!1,headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(e)}};i.checkAndAddProxyAgent(s),r(t,s,e,n)}function r(t,e,n,r){var o=apmInsightAgentInstance.getConfig().isPrintPayloadEnabled()?" with payload "+n:"";s.info("intiating"+t+" request to "+e.host+":"+e.port+o);var c=i.request(e,function(e){e.setEncoding("utf8");var n="";e.on("data",function(t){n+=t}),e.on("end",function(){try{if(a.isEmpty(n))return void r(!1,t);const e=JSON.parse(n);r(!1,t,e)}catch(o){r(o,t)}})});c.on("error",function(e){r(e,t)}),c.write(n),c.end()}var o=cachedModules[8837].exports,i=require("https"),a=cachedModules[4747].exports,s=cachedModules[6725].exports;t.exports={sendToCollector:n,sendRequest:r}}.call(this,cachedModules[1562],cachedModules[1562].exports),cachedModules[2318]={exports:{}},function(t,e){function n(t){var e=c[t];return e?e.name:t}function r(t,e){var n,r=c[t];if(!r)return s.critical(" Unknown response code ::"+t),!0;if(!r.timeInterval)return s.info(" No time limit restriction for response code ::"+t),!0;for(var o=0;o<r.timeInterval.length;o++)if(n=r.timeInterval[o],n>e)return e%r.reqInterval[o]==0;return e>n?e%r.exhaust==0:!0}function o(t,e){if(!t)return!1;var n=c[t];return n?!!(n.shutdown&&e>n.shutdown):(s.critical(" Unknown response code ::"+t),!1)}function i(t,e){if(!t||!e)return 1;var n=c[t];if(!n)return s.critical(" Unknown response code ::"+t),1;if(n.timeInterval){var r=(new Date).getTime(),o=(r-e)/6e4;return parseInt(o)}return 1}function a(t){return!(!t||!c[t])}var s=cachedModules[6725].exports,c={701:{name:"LICENSE_EXPIRED",timeInterval:[10,30,60,4320],reqInterval:[1,2,5,15],exhaust:60,shutdown:21600},702:{name:"LICENSE_INSTANCES_EXCEEDED",timeInterval:[10,30,60,4320],reqInterval:[1,2,5,15],exhaust:60,shutdown:21600},703:{name:"INSTANCE_ADD_FAILED",timeInterval:[10,20,30],reqInterval:[1,2,5],exhaust:15},704:{name:"INSUFFICIENT_CREDITS",shutdown:-1},900:{name:"MARKED_FOR_DELETE",timeInterval:[10,20,30],reqInterval:[1,2,5],exhaust:15,shutdown:4320},901:{name:"INVALID_AGENT",timeInterval:[10,20,30],reqInterval:[1,2,5],exhaust:15,shutdown:4320},910:{name:"UNMANAGE_AGENT"},911:{name:"MANAGE_AGENT"},0:{name:"SHUTDOWN"}};t.exports={getRescodeMessage:n,isAllowedToSendRequest:r,isRetryLimitExceeded:o,getRetryCounter:i,isValid:a}}.call(this,cachedModules[2318],cachedModules[2318].exports),cachedModules[5832]={exports:{}},function(t,e){function n(t){function e(t){s.isNonEmptyString(t.insId)&&(n=t.insId,i=t.name,c.info("application hosted in "+i))}var n,i,a=r().then(e),p=o().then(e),u=[a,p];Promise.all(u).then(function(){t(n,i)})}function r(){var t={host:p.cloudCheckerHost,path:"/latest/meta-data/instance-id"};return new Promise(function(e,n){i(t,function(t){e({insId:t,name:p.aws})})})}function o(){var t={host:p.cloudCheckerHost,path:"/metadata/v1/InstanceInfo"};return new Promise(function(e,n){i(t,function(t){var n;try{if(t){var r=JSON.parse(t);n=r.ID}}catch(o){c.error("azure response parser error")}e({insId:n,name:p.azure})})})}function i(t,e){var n=a.request(t,function(t){if(t.statusCode<200||t.statusCode>299)return void e();t.setEncoding("utf8");var n="";t.on("data",function(t){n+=t}),t.on("end",function(){e(n)})});n.on("socket",function(t){t.setTimeout(500),t.on("timeout",function(){n.abort()})}),n.on("error",function(t){e()}),n.end()}var a=require("http"),s=cachedModules[4747].exports,c=cachedModules[6725].exports,p=cachedModules[8837].exports;t.exports={doCloudCheck:n}}.call(this,cachedModules[5832],cachedModules[5832].exports),cachedModules[2366]={exports:{}},function(t,e){function n(){var t=[],e={},n=new T({});return r(I.getWebTxnMetric(),x.webTxnPrefix,x.apdex,t,e,n),t.length>0&&(o(n,"",x.apdex,t),a(e,"",t)),r(I.getBgTxnmetric(),x.bgTxnPrefix,x.bckgrnd,t,e),p(t),v.info("total metric collected "+t.length),t}function r(t,e,n,r,a,s){var c=Object.keys(t);c.forEach(function(c){var p=t[c];if(!p)return void v.critical("empty txn present in data store");var u=e+p.getUrl();o(p,u,n,r,s),i(p,u,r,a)})}function o(t,e,n,r,o){var i={ns:e,name:n},a=t.getFormattedRtData(),s=[i,a];r.push(s),o&&o.aggregate(t)}function i(t,e,n,r){var o={};t.getDbCalls().forEach(function(t){var e=t.extractOperationInfo();if(!_.isEmpty(e.opn)&&!_.isEmpty(e.object)){var n="db/"+e.opn+"/"+e.object+"/dummy-db",r=o[n]||new C.DbTracker({});r.aggregate(t),o[n]=r}}),a(o,e,n,r)}function a(t,e,n,r){Object.keys(t).forEach(function(o){var i=t[o],a=i.extractOperationInfo();if(!_.isEmpty(a.opn)&&!_.isEmpty(a.object)){var p=c(i,e,o);if(r){var u="db/"+a.opn+"/all/dummy-db";s(r,u,i),s(r,x.dbOpnOverAll,i)}n.push(p)}})}function s(t,e,n){var r=t[e]||new C.DbTracker({});r.aggregate(n),t[e]=r}function c(t,e,n){var r={ns:e,name:n},o=[t.getTime(),t.getMinRt(),t.getMaxRt(),t.getCount(),t.getErrorCount()];return[r,o]}function p(t){u(t),h(t)}function u(t){var e=I.getAppMetricSum(),n=Object.keys(e);if(!(n.length<=0)){var r={ns:x.appParam,name:x.sumStr},o=[[e]];t.push([r,o])}}function h(t){var e=I.getAppMetricAvg(),n=Object.keys(e);if(!(n.length<=0)){var r={};n.forEach(function(t){var n=e[t],o=[n.total,n.min,n.max,n.count,0];r[t]=o});var o={ns:x.appParam,name:x.avgStr},i=[[r]];t.push([o,i])}}function d(){var t=[],e=I.getTraceMetric();return v.info("number of trace collected::"+e.length),e.forEach(function(e){var n=e.getTraceInfo(),r=l(e,n);t.push([n,r])}),t}function l(t,e){var n=[],r=[],o=t.getRootTracker();g(n,o);for(var i=o.getChildTrackers(),a=0;a<i.length;a++){var s=i[a];f(s,e,r)}return n.push(r),n}function g(t,e){t.push(e.getStartTime()),t.push(e.getTrackerNameForTrace()),t.push(e.getComponent()),t.push(e.getTime()),t.push(e.getTime()),t.push(null)}function f(t,e,n,r){if(t&&!(e.method_count>x.maxTrackers)){r=m(t,e,n,r);for(var o=t.getChildTrackers(),i=0;i<o.length;i++){var a=o[i];f(a,e,n,r)}}}function m(t,e,n,r){if(t.isAllowedInTrace()){var o=y(t,e);return r?r[6].push(o):n.push(o),t.isDistributedTrace()&&e.dt_count++,e.method_count++,o}return r}function y(t,e){var n=[t.getStartTime(),t.getTrackerNameForTrace(),t.getComponent(),t.getTime(),t.getTime(),t.getAdditionalInfo(),[]];if(t.isDbTracker){var r=t.extractOperationInfo();if(r.opn&&r.object){var o=r.opn+"/"+r.object;e.db_opn.indexOf(o)<0&&e.db_opn.push(o)}}if(t.isError()&&e.loginfo.length<x.maxExcPerTrace){var i=t.getErrorInfo(),a={};a.time=i.getTime(),a.level=i.getLevel(),a.str=i.getMessage(),a.err_clz=i.getType(),a.st=i.getErrorStackFrames(),e.loginfo.push(a)}return n}var I=cachedModules[3996].exports,x=cachedModules[8837].exports,T=cachedModules[2486].exports,v=cachedModules[6725].exports,x=cachedModules[8837].exports,_=cachedModules[4747].exports,C=cachedModules[9164].exports;t.exports={getTxnMetric:n,getFormattedTraceData:d}}.call(this,cachedModules[2366],cachedModules[2366].exports),cachedModules[2708]={exports:{}},function(t,e){function n(){if(!apmInsightAgentInstance.getConfig().isAppIdConfigured()){if(apmInsightAgentInstance.getConfig().isInsIdConfigured())return L=!0,apmInsightAgentInstance.getInsInfo().setStatus(911),void r();o(),r()}}function r(){setInterval(function(){try{if(E.info("data processing starts"),apmInsightAgentInstance.getInsInfo().getStatus()===b.shutdown)return void E.critical("agent is shutdown state");if(!L)return void i();u(),E.info("data processing ends")}catch(t){E.error("Exception occured in data processing ::",t)}finally{k.clearMetric()}},6e4).unref(),setInterval(function(){k.clearTraceHistory()},9e5).unref()}function o(){L||i()}function i(){return M?void a():void I(function(t){M=t,a()})}function a(){var t=apmInsightAgentInstance.getConfig();if(!t.isConfiguredProperly())return void E.critical("agent not configured properly check require statement licenseKey, appName must be non empty string and port must be a positive number");var e=apmInsightAgentInstance.getInsInfo();(!e.getStatus()||P.isAllowedToSendRequest(e.getStatus(),e.getRetryCounter()))&&(A=A?A:C(b.connectUrl,M),S.sendRequest(b.connectUrl,A,M,s))}function s(t,e,n){if(p(t,e,n)){var r=n.data,o=r[b.responseCode],i=r[b.instanceInfo];if(o&&E.critical("received response code :",P.getRescodeMessage(o)),!i||O.isEmpty(i[b.instanceid]))return void apmInsightAgentInstance.getInsInfo().updateStatus(o);var a=i[b.instanceid];apmInsightAgentInstance.getInsInfo().updateInstanceInfo(a,o),apmInsightAgentInstance.getConfig().updateCollectorInfo(r[b.collectorInfo]),apmInsightAgentInstance.getThreshold().update(r[b.customConfigInfo],r[b.agentSpecifInfo]),L=!0}}function c(t,e,n){if(p(t,e,n)){var r=n.data,o=r[b.responseCode],i=apmInsightAgentInstance.getInsInfo();o&&o!==i.getStatus()&&E.critical("received response code :",P.getRescodeMessage(o)),i.updateStatus(o),apmInsightAgentInstance.getConfig().updateCollectorInfo(r[b.collectorInfo]),(r[b.customConfigInfo]||r[b.agentSpecifInfo])&&apmInsightAgentInstance.getThreshold().update(r[b.customConfigInfo],r[b.agentSpecifInfo])}}function p(t,e,n){return t?(E.error("Error occured for in "+e+" request",t),!1):n&&n.data?(E.info("Response data for "+e,n),!0):(E.critical("received empty response data for "+e+" request"),!1)}function u(){var t=apmInsightAgentInstance.getInsInfo();switch(apmInsightAgentInstance.getConfig().isCatalyst()?finalUrlList=[b.dataServerlessUrl,b.traceServerlessUrl]:finalUrlList=[b.dataUrl,b.traceUrl],t.getStatus()){case b.manageAgent:return void h(t,s,finalUrlList);case b.unmanageAgent:var e=JSON.stringify(y(t,[]));return void S.sendToCollector(finalUrlList[0],e,c);default:if(P.isAllowedToSendRequest(t.getStatus(),t.getRetryCounter())){var e=JSON.stringify(y(t,[]));S.sendToCollector(finalUrlList[0],e,c)}else E.critical("request will be send in specific interval");return}}function h(t,e,n){var r=JSON.stringify(y(t,F.getTxnMetric()));S.sendToCollector(n[0],r,e);var o=F.getFormattedTraceData();if(o&&o.length>0){var i=JSON.stringify(y(t,o));S.sendToCollector(n[1],i,e)}}function d(t){var e=apmInsightAgentInstance.getConfig(),n=l(t),r=g(t);console.log("site24x7-apminsight-data"+JSON.stringify({licenseKey:e.getLicenseKey(),appId:e.getAppId(),host:e.getApmHostName(),port:e.getApmPort(),data:JSON.stringify(n),trace:JSON.stringify(r)}))}function l(t){var e=y(t,F.getTxnMetric());return e}function g(t){var e=y(t,F.getFormattedTraceData());return e}function f(t){var e=l(t);m("data",e);var n=g(t);m("trace",n)}function m(t,e){var n=apmInsightAgentInstance.getConfig(),r=apmInsightAgentInstance.getInsInfo(),o=n.getWriteFileBaseDir();try{var i=JSON.stringify(e),a=new Date,s=a.getTime();dataDir=w.join(o,n.getLicenseKey(),r.getInstanceId(),t),R.existsSync(dataDir)||R.mkdirSync(dataDir,{recursive:!0});var c=w.join(dataDir,t+"_"+s+"_"+D.pid+".json");R.writeFileSync(c,i,"utf8",function(e){return e?void E.error("Unable to write state information in file",e):void E.info(t+" written in the file successfully")})}catch(p){E.error("Error while creating file",p)}}function y(t,e){var n=(new Date).getTime(),r=t.getLastReported()?t.getLastReported():n;return[n,r,e]}function I(t){q.doCloudCheck(function(e,n){var r=apmInsightAgentInstance.getConfig(),o={agent_info:{"application.type":b.applicationType,"agent.version":r.getAgentVersion(),"application.name":x(r,n),port:r.getApplicationPort(),"host.type":O.isEmpty(n)?N.platform():n,hostname:T(e,n)},environment:{UserName:D.env.USER,OSVersion:N.release(),MachineName:N.hostname(),AgentInstallPath:r.getAgentInstalledPath(),"NODEJS version":D.version,OSArch:N.arch(),OS:N.platform()}};v(o),_(o),t(JSON.stringify(o))})}function x(t,e){return e===b.azure&&O.isNonEmptyString(D.env.WEBSITE_SITE_NAME)?(t.setApplicationName(D.env.WEBSITE_SITE_NAME),D.env.WEBSITE_SITE_NAME):t.getApplicationName()}function T(t,e){return e===b.azure&&O.isNonEmptyString(D.env.WEBSITE_HOSTNAME)?D.env.WEBSITE_HOSTNAME:O.isEmpty(t)?N.hostname():t}function v(t){try{var e=w.join(D.cwd(),"package.json"),n=JSON.parse(R.readFileSync(e));n&&n.dependencies&&(t.environment.dependencies=n.dependencies)}catch(r){E.info("package.json file not in process started path")}}function _(t){try{var e=R.readFileSync("/proc/1/cgroup","utf8");if(e){var n=/cpu:\/(lxc|docker)\//g,r=n.exec(e);r&&(t.agent_info["host.type"]="DOCKER")}}catch(o){E.info("not docker environment")}}function C(t,e){var n=apmInsightAgentInstance.getConfig(),r=apmInsightAgentInstance.getInsInfo(),o={host:n.getApmHostName(),port:n.getApmPort(),path:t+"?"+b.licenseKey+"="+n.getLicenseKey()+"&"+b.instance_Id+"="+r.getInstanceId(),method:b.requestMethod,rejectUnauthorized:!1,headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(e)}};return n.checkAndAddProxyAgent(o),o}var A,M,k=cachedModules[3996].exports,b=cachedModules[8837].exports,E=cachedModules[6725].exports,S=cachedModules[1562].exports,N=require("os"),R=require("fs"),w=require("path"),D=require("process"),P=cachedModules[2318].exports,O=cachedModules[4747].exports,q=cachedModules[5832].exports,F=cachedModules[2366].exports,L=!1;t.exports={init:n,checkAndSendConnect:o,formatAndSendCollectedData:h,printCollectedDataInStdout:d,writePayloadInFilePath:m,processAndWriteData:f,processCollectedData:u}}.call(this,cachedModules[2708],cachedModules[2708].exports),cachedModules[4774]={exports:{}},function(t,e){function n(t){this._componentName=void 0!==t.component?t.component:t.getComponent(),this._rt=void 0!=t.rt?t.rt:t.getTime(),this._isExt=void 0!==t.isExt?t.isExt:r(this._componentName),this._count=t.count>=0?t.count:t.isError()?0:1,this._errorCount=t.errorcount>=0?t.errorcount:t.isError()?1:0,this._host=void 0!==t.host?t.host:t.getInfo().host||"",this._port=t.port||t.getInfo().port||-1,t.instance_id?this._instance_id=t.instance_id:t._dtrace&&(this._instance_id=apmInsightAgentInstance.getInsInfo().getInstanceId())}function r(t){return o.externalComponents.indexOf(t)>=0?1:0}var o=cachedModules[8837].exports,i=cachedModules[4747].exports;n.prototype.getName=function(){return this._componentName},n.prototype.getRt=function(){return this._rt},n.prototype.isExt=function(){return this._isExt},n.prototype.getCount=function(){return this._count},n.prototype.getErrorCount=function(){return this._errorCount},n.prototype.getHost=function(){return this._host},n.prototype.getPort=function(){return this._port},n.prototype.getInsId=function(){return this._instance_id},n.prototype.isSameMachine=function(t){return this.isExt()?t&&this.getHost()===t.getHost()&&this.getPort()===t.getPort():!0},n.prototype.aggregate=function(t){this._componentName=t.getName(),this._rt+=t.getRt(),this._count+=t.getCount(),this._errorCount+=t.getErrorCount()},n.prototype.aggregateAsNewComponent=function(t){var e={};return e.component=this.getName(),e.rt=this.getRt()+t.getRt(),e.isExt=this.isExt(),e.count=this.getCount()+t.getCount(),e.errorcount=this.getErrorCount()+t.getErrorCount(),e.host=this.getHost(),e.port=this.getPort(),this.getInsId()&&(e.instance_id=this.getInsId()),new n(e)},n.prototype.getInfoAsObj=function(){var t={};t.name=this.getName(),t.rt=this.getRt(),t.ct=this.getCount(),t.isExt=this.isExt(),this.getErrorCount()>0&&(t.error=this.getErrorCount());var e=parseInt(this.getPort());return!i.isEmpty(this.getHost)&&e>0&&(t.host=this.getHost(),t.port=e),this.getInsId()&&(t.instance_id=this.getInsId()),t},t.exports={Component:n}}.call(this,cachedModules[4774],cachedModules[4774].exports),cachedModules[8914]={exports:{}},function(t,e){function n(t,e){var n=t.getInsId()||(t.isAppIdConfigured()?t.getAppId():e.instanceId);this._instanceId=n?n:"",this._status=e.status,this._modifiedTime=e.time,this._lastReported=null,this._retryCounter=p.getRetryCounter(e.status,e.time),this._apmInfoFilePath=r(e.agentBaseDir)}function r(t){return s.isEmpty(t)?void 0:i.join(t,"apminsight.json")}var o=require("fs"),i=require("path"),a=cachedModules[6725].exports,s=cachedModules[4747].exports,c=cachedModules[8837].exports,p=cachedModules[2318].exports;n.prototype.getInstanceId=function(){return this._instanceId},n.prototype.updateInstanceInfo=function(t,e){this.updateLastReported(),s.isEmpty(t)||(this._instanceId!==t||this._status!==e)&&(this._instanceId=t,this._status=e?e:c.manageAgent,this._modifiedTime=(new Date).getTime(),this._retryCounter=1,this.writeInfotoFile())},n.prototype.getStatus=function(){return this._status},n.prototype.setStatus=function(t){this._status=t},n.prototype.getModifiedTime=function(){return this._modifiedTime},n.prototype.getRetryCounter=function(){return this._retryCounter},n.prototype.updateLastReported=function(){this._lastReported=(new Date).getTime()},n.prototype.getLastReported=function(){return this._lastReported},n.prototype.updateStatus=function(t){if(this.updateLastReported(),p.isValid(t)&&(this._retryCounter=this._status===t?this._retryCounter+1:1,this._instanceId&&1===this._retryCounter&&(this._status=t,this._modifiedTime=(new Date).getTime(),this._retryCounter,this.writeInfotoFile()),p.isRetryLimitExceeded(t,this._retryCounter))){a.critical(" Retry limit exceeded for response code :"+t+" so Agent goes to shutdown state"),this._status=0;var e={status:0,time:(new Date).getTime()};this.writeInfotoFile(e)}},n.prototype.getAsJson=function(){return{instanceId:this._instanceId,status:this._status,time:this._modifiedTime}},n.prototype.writeInfotoFile=function(t){if(!s.isEmpty(this._apmInfoFilePath)){var e=JSON.stringify(t?t:this.getAsJson());o.writeFile(this._apmInfoFilePath,e,"utf8",function(t){return t?void a.error("Unable to write state information in file",t):void a.info("Instance info written in apminsight.json file successfully")})}},t.exports=n}.call(this,cachedModules[8914],cachedModules[8914].exports),cachedModules[6100]={exports:{}},function(t,e){function n(t,e){this._config=t,this._threshold=new p.Threshold,this._insinfo=new m(t,e),this._curTxn=null,this._curTracker=null}function r(t){t.agentBaseDir=u.checkAndCreateBaseDir(t);var e=new c.Configuration(t);if(d.init(e),global.apmInsightAgentInstance)d.error("apmInsightAgentInstance already injected in global scope");else{var r=u.loadInfoFileSync(e.getBaseDir());r.agentBaseDir=e.getBaseDir(),global.apmInsightAgentInstance=new n(e,r),l.start(),g.init()}}var o=cachedModules[2486].exports,i=cachedModules[7784].exports,a=cachedModules[9164].exports,s=cachedModules[8837].exports,c=cachedModules[922].exports,p=cachedModules[9344].exports,u=cachedModules[4747].exports,h=cachedModules[3996].exports,d=cachedModules[6725].exports,l=cachedModules[7395].exports,g=cachedModules[2708].exports,f=cachedModules[4774].exports,m=cachedModules[8914].exports,y=cachedModules[5982].exports;n.prototype.createTxn=function(t,e,n){if(this.clearCurContext(),!this.isDataCollectionAllowed())return void d.info("data collection is not allowed in agent inactive state");var r=u.parseReq(t);if(!this._threshold.isTxnAllowed(r.uri))return void d.info(t.url+" txn skipped because of config");r.rootListner=n;var i=new o(r,t);return this.setCurContext(i,i.getRootTracker()),this.checkAndInstrumentResponse(i,e),this.handleCrossAppRequest(t,e,i),i},n.prototype.checkAndInstrumentResponse=function(t,e){if(e){if(u.isFunction(e.write)&&u.isFunction(e.end)){var n=e.write,r=e.end,o=0;e.write=function(t){var e=n.apply(this,arguments);return o+=u.isNonEmptyString(t)?Buffer.byteLength(t):0,e},e.end=function(e){var n=r.apply(this,arguments);return o+=u.isNonEmptyString(e)?Buffer.byteLength(e):0,t.setBytesOut(o),n}}u.isFunction(e.on)&&e.on("finish",function(){apmInsightAgentInstance.endTxn(t,e)})}},n.prototype.handleCrossAppRequest=function(t,e,n){apmInsightAgentInstance.getThreshold().isDistributedTracingEnabled()&&t.headers&&this.getConfig().getLicenseKeySuffix()===t.headers[s.crossAppReqHeaderLower]&&e.setHeader(s.crossAppResHeader,JSON.stringify({s_time:n.getStartTime(),t_name:s.webTxnPrefix+n.getUrl(),instance_id:this.getInsInfo().getInstanceId()}))},n.prototype.endTxn=function(t,e){this.isDataCollectionAllowed()&&!u.isEmpty(t)&&(this.getCurTracker()&&!this.getCurTracker().isCompleted()&&this.getCurTracker().endTracker(),t.endTransaction(e))},n.prototype.startApiTransaction=function(t,e,n){if(!this.isOkayToCreateTxn(t,e,n))return e();this.clearCurContext();var r=u.isEmpty(e.name)?"Anonymous":e.name,a={uri:t,rootListner:r,api:!0},s=n?new i(a):new o(a),c=s.getRootTracker();this.setCurContext(s,c);try{var p=e();return y.checkAndWrapPromise(p,s,c),p}catch(h){throw this.handleErrorTracker(c,h),h}finally{this.clearCurContext()}},n.prototype.isOkayToCreateTxn=function(t,e,n){return this.isDataCollectionAllowed()?u.isEmpty(t)?(d.critical("create txn invoked with empty txn name"),!1):u.isFunction(e)?n&&!this.getThreshold().isBgTxnTrackingEnabled()?(d.info("bg txn tracking disabled"),!1):!0:(d.critical("create txn invoked without function param"),!1):(d.info("data collection is not allowed in agent inactive state"),!1)},n.prototype.endApiTxn=function(t){this._curTxn&&this._curTxn.endApiTxn(t)},n.prototype.setTransactionName=function(t){this._curTxn&&this._curTxn.setTransactionName(t)},n.prototype.addParameter=function(t,e){this._curTxn&&this._curTxn.setCustomParams(t,e)},n.prototype.ignoreCurTxn=function(){this._curTxn&&this._curTxn.setIgnore()},n.prototype.createTracker=function(t){if(this.getCurTxn()){var e;if(t.parent=t.parent?t.parent:this.getCurTracker(),t.isDbTracker){if(!this._threshold.isSqlCaptureEnabled())return;e=new a.DbTracker(t)}else e=new a.Tracker(t);this.setCurTracker(e);var n=t.parent?t.parent:this.getCurTxn().getRootTracker();return n.addChildTracker(e),e}},n.prototype.createCustomTracker=function(t,e,n,r){if(u.isFunction(n)){if(!this.getCurTxn()||this.getCurTxn().isCompleted())return n(r);var o=this.getCurTracker(),i=u.isEmpty(n.name)?"Custom-Tracker":n.name;t=u.isNonEmptyString(t)?t:i;var a={trackerName:t,component:e,api:!0};if(a.parent=o,u.isFunction(r))try{var s=this.createTracker(a);return r=y.wrapCallBack(r,s,this.getCurTxn()),n(r)}catch(c){this.handleErrorTracker(s,c)}finally{this.setCurContext(this.getCurTxn(),o)}else try{a.sync=!0;var s=this.createTracker(a),p=n(r);return p&&u.isFunction(p.then)?y.checkAndWrapPromise(p,this.getCurTxn(),s):this.endTracker(s,this.getCurTxn()),p}catch(c){this.handleErrorTracker(s,c)}finally{this.setCurContext(this.getCurTxn(),o)}}},n.prototype.endTracker=function(t,e){t&&(t.endTracker(e?e:this._curTxn),this._curTracker===t&&this.clearCurTracker())},n.prototype.handleErrorTracker=function(t,e){t&&(t.endTracker(this._curTxn,e),this.clearCurTracker())},n.prototype.endContextTracker=function(t){this._curTxn&&this._curTracker&&(this._curTracker.endTracker(this._curTxn,t),this.clearCurTracker())},n.prototype.trackError=function(t){if(t instanceof Error){var e=this._curTracker,n=this.createTracker({trackerName:"Error",sync:!0,parent:e});n&&(n.setError(t,this._curTxn),n.endTracker(this._curTxn)),this.setCurContext(this._curTxn,e)}},n.prototype.endRootTracker=function(t){u.isEmpty(this._curTxn)||this._curTxn.endRootTracker(t)},n.prototype.monitorFunction=function(t){if(!u.isFunction(t))return t;var e=y.wrapAndMonitorFunction(t);return this.getThreshold().applyConfigForFaas(),e},n.prototype.sendMetricsImmediately=function(){var t=this.getInsInfo();return u.isNonEmptyString(apmInsightAgentInstance.getConfig().getWriteFileBaseDir())?void g.processAndWriteData(t):u.isEmpty(process.env.LAMBDA_TASK_ROOT)?void g.formatAndSendCollectedData(t,function(){}):void g.printCollectedDataInStdout(t)},n.prototype.checkAndAddComponent=function(t,e){if(t&&(t.incrTrackersCount(),!u.isEmpty(e.getComponent()))){var n=new f.Component(e);t.aggregateComponent(n)}},n.prototype.incrementCustomMetric=function(t,e){return this.isDataCollectionAllowed()?void h.incrAppMetric(t,e):void d.info("data collection is not allowed in agent inactive state")},n.prototype.averageCustomMetric=function(t,e){return this.isDataCollectionAllowed()?void h.avgAppMetric(t,e):void d.info("data collection is not allowed in agent inactive state")},n.prototype.setCurTxn=function(t){this._curTxn=t},n.prototype.getCurTxn=function(){return this._curTxn},n.prototype.clearCurTxn=function(){this._curTxn=null},n.prototype.setCurTracker=function(t){this._curTracker=t},n.prototype.getCurTracker=function(){return this._curTracker},n.prototype.clearCurTracker=function(){this._curTracker=null},n.prototype.setCurContext=function(t,e){this.setCurTxn(t),this.setCurTracker(e)},n.prototype.clearCurContext=function(){this._curTxn=null,this._curTracker=null},n.prototype.getThreshold=function(){return this._threshold},n.prototype.getConfig=function(){return this._config},n.prototype.isDataCollectionAllowed=function(){var t=this._insinfo.getStatus();return!t||t===s.manageAgent},n.prototype.getInsInfo=function(t){return this._insinfo},t.exports={
Agent:n,init:r}}.call(this,cachedModules[6100],cachedModules[6100].exports),cachedModules[1185]={exports:{}},function(t,e){t.exports={name:"apminsight",version:"1.7.4",description:"monitor nodejs web applications",main:"index.js",scripts:{test:'echo "Error: no test specified" && exit 1'},keywords:["site24x7","apm","apminsight","monitoring","performance"],author:"apm-insight@zohocorp.com",engines:{node:">=6.0.0"},license:"SEE LICENSE IN license.txt",homepage:"https://www.site24x7.com",dependencies:{"https-proxy-agent":"^5.0.0"}}}.call(this,cachedModules[1185],cachedModules[1185].exports),cachedModules[2510]={exports:{}},function(t,e){function n(t){return function(e){return r(t,e),a.checkAndWrapModule(e,p,"azure"),a.handleRootTrackerInvocation(t,this,arguments)}}function r(t,e){if(e){var n,r=i.isNonEmptyString(t.name)?t.name:"Anonymous",o=i.parseReq(e.req);o.rootListner=r,i.isNonEmptyString(o.uri)?n=new s(o,e.req):(o.uri=r,n=new c(o)),apmInsightAgentInstance.setCurContext(n,n.getRootTracker())}}function o(t){var e=apmInsightAgentInstance.getCurTxn();return function(){return apmInsightAgentInstance.endTxn(e),t.apply(this,arguments)}}var i=cachedModules[4747].exports,a=cachedModules[5982].exports,s=(cachedModules[6725].exports,cachedModules[2486].exports),c=cachedModules[7784].exports,p=[{functionName:"done",wrapper:o}];t.exports={wrapAzureFunction:n}}.call(this,cachedModules[2510],cachedModules[2510].exports);var agent=cachedModules[6100].exports,utils=cachedModules[4747].exports,packageJson=cachedModules[1185].exports,faas=cachedModules[2510].exports,agentInstace;AgentAPI.config=function(t){agentInstace||(includeAgentInfo(t),agent.init(t),agentInstace=global.apmInsightAgentInstance)},AgentAPI.startWebTransaction=function(t,e){return agentInstace?void agentInstace.startApiTransaction(t,e,!1):e()},AgentAPI.startBackgroundTransaction=function(t,e){return agentInstace?void agentInstace.startApiTransaction(t,e,!0):e()},AgentAPI.endTransaction=function(t){agentInstace&&agentInstace.endApiTxn(t)},AgentAPI.startTracker=function(t,e,n,r){return global.apmInsightAgentInstance&&global.apmInsightAgentInstance.getConfig().isCatalyst()?global.apmInsightAgentInstance.createCustomTracker(t,e,n,r):agentInstace?agentInstace.createCustomTracker(t,e,n,r):n()},AgentAPI.trackError=function(t){agentInstace&&agentInstace.trackError(t)},AgentAPI.setTransactionName=function(t){agentInstace&&utils.isNonEmptyString(t)&&agentInstace.setTransactionName(t)},AgentAPI.addParameter=function(t,e){agentInstace&&utils.isNonEmptyString(t)&&agentInstace.addParameter(t,e)},AgentAPI.ignoreCurrentTransaction=function(){agentInstace&&agentInstace.ignoreCurTxn()},AgentAPI.incrementCustomMetric=function(t,e){agentInstace&&agentInstace.incrementCustomMetric(t,e)},AgentAPI.averageCustomMetric=function(t,e){agentInstace&&agentInstace.averageCustomMetric(t,e)},AgentAPI.monitorFunction=function(t){return agentInstace?agentInstace.monitorFunction(t):t},AgentAPI.monitorAzureFunction=function(t){if(agentInstace){var e=faas.wrapAzureFunction(t);return e}return t},module.exports=AgentAPI;
//# sourceMappingURL=UGLIFY_SOURCE_MAP_TOKEN